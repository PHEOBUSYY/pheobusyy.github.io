<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2017/读书笔记/&lt;小狗钱钱&gt;读书笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/06/2017/读书笔记/<小狗钱钱>读书笔记/" class="article-date">
  <time datetime="2017-02-06T07:14:00.000Z" itemprop="datePublished">2017-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/06/2017/读书笔记/<小狗钱钱>读书笔记/">&lt;小狗钱钱&gt;读书笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="lt-小狗钱钱-gt-读书笔记"><a href="#lt-小狗钱钱-gt-读书笔记" class="headerlink" title="&lt;小狗钱钱&gt;读书笔记"></a>&lt;小狗钱钱&gt;读书笔记</h2><p>“并非困难使我们放弃,而是因为我们放弃,才显得如此困难.”</p>
<p>“天下难事,必作于易;天下大事,必作于细.” - 老子</p>
<p>“大多数人并不清楚自己想要什么,他们只知道,自己想得到更多的东西.你可以把自己的生活想象成一家很大的邮购公司.如果你给一家邮购公司写信说’请给我寄一些好东西来’,你肯定什么也得不到.我们的愿望也是一样的.我们必须确切知道自己内心渴望的是什么才行.”</p>
<ul>
<li>目标的明确性很重要,如果只是一个空洞的概念或愿景,是很难有动力去实现的,也无法明确的知道如何去实现,以及最终的实现的效果是什么样的.</li>
</ul>
<p>“不要试试看,而是去切实行动!如果你只是抱着试试看的心态,那么你只会以失败而告终,你会一事无成.’尝试’纯粹是一种借口,你还没有做,就已经给自己想好了退路.不能实验,你只有两个选择—做或者不做.”</p>
<ul>
<li>‘试试’是一种不自信的表现,是自我推脱的借口,意味着自己并没有准备好全力以赴.要么不做,要做就要尽全力.做人要活的洒脱大气</li>
</ul>
<p>“学习就是认识新观念和新想法的工程.假如人们始终以同一种思维方式来思考问题的话,那么始终只会得到同样的结果.因为我对你讲述的许多内容是你以前从未接触过的,所以我建议你,在你还没有做之前,不要轻易的下结论.没有想象力的人很难成就大事的.我们对一件事投入的精力越多,成功的可能性越大.可是大多数人把精力放在自己并不喜欢的事情上,而不去想象自己希望得到的东西.”</p>
<ul>
<li><p>大多数人甚至都不知道自己真正喜欢的是什么.没有尝试过,没有走出去舒适圈,你永远不知道外面的世界是什么样的.走出去意味着可能,原地踏步只会困死在原地.做一辈子平凡的人.回想自己之前不敢换工作,就是不敢迈出那一步而已,虽然到现在也不知道自己到底喜欢的是什么,但是最起码意识到了这个问题,并且在通过读书学习来慢慢的找到喜欢的东西,这就是最大的进步.</p>
</li>
<li><p>在没有做之前不要一概否定,不试试怎么知道行不行呢?</p>
</li>
<li><p>对一件事投入的精力越大,越有可能成功</p>
</li>
</ul>
<p>“有一只海鸥曾经对我说过’在你展翅飞翔之前,你就必须相信自己能够到达目的地.’你必须设想自己拥有了这些东西,这样你的一个小愿望才会变成一种强烈的渴望.你想象的越多,你的愿望就越强烈,那么你就会开始寻找机会来实现自己的梦想.吉娅,机会到处都是,但是只有在你寻找它的时候,你才能看见它.只有当你心中有了强烈的渴望,你才会去寻觅机会.而当你想象的时候,强烈的渴望就产生了.”</p>
<ul>
<li>要自信,相信自己可以得到自己想要的.对未来想象的越清晰,越有动力和激情去实现.</li>
</ul>
<p>“你的自信程度决定了你是否相信自己的能力,是否相信你自己.假如你根本不相信你能做到的话,那么你就根本不会动手去做,而加入你不开始去做,那么你就什么也得不到.”</p>
<ul>
<li>相信自己可以,就一定可以.自我的不断催眠,可以让自己更加的自信强大</li>
</ul>
<p>“你去准备一个本子,给它取名叫’成功日记’,然后把所有做成功的事情记录进去.你最好每天都做这件事,每次都写至少5条你的个人成功,任何小事都可以.开始的时候你觉得不太容易,可能会问自己,这件或那件事情是否真的可以算作成果.在这种情况下,你的回答应该是肯定的.过于自信比不够自信要好得多.”</p>
<ul>
<li>修改一下每日总结的模板,把下面的那个每天三件事改成成功日记.记录自己每天做成功的事情.</li>
</ul>
<p>“商人给了他两个重要的建议:第一,为别人解决一个难题,那么你就可以赚很多的钱;第二,把精力集中在你知道的,能做的和拥有的东西上.”</p>
<ul>
<li>致富的秘诀就在于帮别人解决问题,从自己拥有的技能思想或者身边的资源入手.利用信息不对等法则.</li>
</ul>
<p>“但是,我想提醒你两件重要的事情.第一,无论什么时候都不要把希望只寄托在一份工作上,它持续的时间不会像你设想的那么长,所以你要立即寻找另一份替代的工作.第二,你肯定会遇到一些困难,这些困难是你现在还难以预料的.”</p>
<ul>
<li>鸡蛋不要放在同一个篮子里,要有不同的求胜技能.增加适应风险的能力,墨菲定律,比如车子被剐蹭不可避免,要做好应对措施.</li>
</ul>
<p>“我要告诉你三件很重要的事情.首先,在遇到困难的时候,仍然要坚持自己的想法.一些正常的时候,每个人都能做到这一点.只有当真正困难出现时才能见分晓.只有少数人能坚定不移地贯彻自己的计划.那么非常成功的人,甚至有能力在他们最困难的时候作出最杰出的表现.第二点,在一切进展顺利的情况下,你也应该做这些事情.每天记录自己的成功.最后,当你决定做一件事情的时候,你必须在72小时之内完成,否则你很可能永远不会再做了.”</p>
<ul>
<li>“风生水起才知天高云淡,沧海横流方显英雄本色”</li>
<li>遭遇挫折时要坚持自己的想法,顺利更要坚持自己的想法.宠辱不惊</li>
<li>72小时完成</li>
</ul>
<p>“所有的消费贷款都是不明智的.聪明的做法只把以前积累起来的财富用于支出.”</p>
<ul>
<li><p>对应&lt;穷爸爸,富爸爸&gt;里面的资产和负债的区别.只有用利息购买的东西才是真正的支出.</p>
</li>
<li><p>在购买东西之前,认真的问问自己”这真的有必要吗?”</p>
</li>
</ul>
<p>“金钱能成为我们生活中非常强大的推理.金钱可以在一定程度上提高我们的生活水平-生活的许多方面都是以钱为基础的.有了钱,我们更容易的实现我们的目标和梦想-当然,包括好的目标和梦想,也包括坏的目标和梦想.”</p>
<ul>
<li>很多人都把金钱和梦想的关系给颠倒了.是先有钱再去实现梦想才对.而不是把梦想和钱挂钩.好比工作只是用来养家糊口的,事业才是真正实现梦想的途径.</li>
</ul>
<p>“我生命中出现了最美好的东西,是因为我做了原本不敢做的事.”<br>“最珍贵的礼物是我们争取来的.克服了丢面子的恐惧,世界就会向你敞开大门.”</p>
<ul>
<li>勇敢的迈出那一步,会收获很多惊喜</li>
</ul>
<p>“成功会使人骄傲.如果你骄傲自大,你就会停止学习.不学习,人就不会再进步.”</p>
<ul>
<li>永远要不断的学习,不断的进步.</li>
</ul>
<p>“恐惧总是出现在我们设想事情会如何不顺利的时候.我们的失败的可能性想的越多,就会越害怕.而当你看着自己的成功日记的时,你就会注意到那些成功的事情,自然而然也就会想到应该怎样去做.”<br>“当你朝着积极地目标去思考的时候,就不会心生畏惧.”</p>
<ul>
<li>我们唯一恐惧就是恐惧本身.回头想想大多数我们担心的事情都没有发生过.同时即使失败了后果也没有我们想到那么严重.</li>
</ul>
<p>“我们的咒语是:</p>
<ol>
<li>确定自己希望获得财务上的成功.</li>
<li>自信,有想法,做自己喜欢的事.</li>
<li>把钱分为日常开销,梦想目标和金鹅账户三部分.</li>
<li>进行明智的投资</li>
<li>享受生活.<br>“</li>
</ol>
<ul>
<li>对待财富的态度和处理方法就是上面说的5个方式.</li>
</ul>
<p>“不要为失去的东西而忧伤,而要对拥有它的时光心存感激.对我来说,这句话的意思是:从现在开始,我再也得不到钱钱的建议了,但我还是必须应对各种情况.”</p>
<ul>
<li>要学会感恩,感谢现在自己拥有的一切.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/02/06/2017/读书笔记/<小狗钱钱>读书笔记/" data-id="cizy2lg2i002jszs6u12gtudu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/读书笔记/启示录-打造用户喜爱的产品" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/24/2017/读书笔记/启示录-打造用户喜爱的产品/" class="article-date">
  <time datetime="2017-01-24T06:03:00.000Z" itemprop="datePublished">2017-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/24/2017/读书笔记/启示录-打造用户喜爱的产品/">启示录-打造用户喜爱的产品</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="启示录-打造用户喜爱的产品-读书笔记"><a href="#启示录-打造用户喜爱的产品-读书笔记" class="headerlink" title="启示录-打造用户喜爱的产品 读书笔记"></a>启示录-打造用户喜爱的产品 读书笔记</h2><p>我的日常工作明确分为三个部分: 人员,流程,产品</p>
<ul>
<li>人员是指负责定义和开发产品的团队成员的角色和职责</li>
<li>流程是指探索,开发富有创意的产品时,反复应用的步骤和成功的实践经验</li>
<li>产品是指富有创意的产品具有的鲜明特性</li>
</ul>
<h3 id="人员"><a href="#人员" class="headerlink" title="人员"></a>人员</h3><p>产品经理的主要职责分为两项: 评估产品机会;定义要开发的产品</p>
<p>现代软件的产品团队组成:</p>
<ul>
<li>产品经理</li>
<li>用户体验设计师</li>
<li>项目管理人员</li>
<li>开发团队</li>
<li>运维团队</li>
<li>产品营销人员</li>
</ul>
<p>必须清晰的界定产品经理和产品营销人员的职责.产品经理负责详细定义待开发的产品,让真实的用户测试产品.产品营销人员负责向外界宣传和推广产品,负责产品发布,为拓展市场销售渠道,组织重点营销活动(如在线营销),促进产品销售提供支持.</p>
<p>产品管理通常使用了 <em>并行开发</em> 和 <em>火车模型发布模式</em></p>
<p>优秀产品经理身上的7个特点:</p>
<ol>
<li>工作紧迫感</li>
<li>善于捕捉问题</li>
<li>思路清晰</li>
<li>用数据说话</li>
<li>果断</li>
<li>判断力</li>
<li>态度</li>
</ol>
<p>用户体验设计包含的方面:</p>
<ul>
<li>用户研究</li>
<li>交互设计</li>
<li>视觉设计</li>
<li>原型制作</li>
</ul>
<p>如果产品没有市场价值,那么无论开发团队多么优秀也无济于事.很多优秀的产品是程序员抓住用户需求,自己创业研发出来的.放宽眼界不仅仅有利于开发人员自己的职业发展,也有利于产品,顾客和公司.</p>
<p>关于留出时间调整代码的参考建议:</p>
<ol>
<li>针对开发团队确定的产品修改目标制定切实可行的计划和时间表</li>
<li>只要有可能,最好把重写目标分成几大块,实现递增修改,让用户感受到产品的改进,哪怕会因此把九个月的工作时间延长到两年,也一定要采用这种方式.</li>
<li>由于开发用户可见功能的资源有限,必须谨慎悬着正确的产品特性,确保产品定义的正确性</li>
</ol>
<p>产品经理应该有的特质:</p>
<ol>
<li>对产品的热情</li>
<li>用户立场</li>
<li>智力</li>
<li>职业操守</li>
<li>正直</li>
<li>信心</li>
<li>态度</li>
<li>技能</li>
<li>运用技术的能力</li>
<li>注意力</li>
<li>时间管理</li>
<li>沟通技能</li>
<li>商业技能</li>
</ol>
<p>产品总监的关键职责有两个方面.第一,组建优秀的产品经理团队.第二,规划公司的全局产品战略.</p>
<p><em>永远不要告诉别人怎么做,告诉他们做什么,他们自然会发挥天赋,给你惊喜. -巴顿</em></p>
<p>一定问明白客户”要做什么?” 而不是 “怎么做?”</p>
<p>管理上司的十条经验</p>
<ol>
<li>为项目波动做好准备</li>
<li>注意沟通的方式和频率</li>
<li>会前沟通</li>
<li>多用建议,少提问题</li>
<li>向上司借力</li>
<li>充分准备</li>
<li>缩短邮件篇幅</li>
<li>多用数据和事实说话</li>
<li>内部宣传</li>
<li>做让领导省心的员工</li>
</ol>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>  为了评估产品机会,我要求产品经理回答如下是个问题:</p>
<ol>
<li>产品要解决什么问题? (产品价值)</li>
<li>为谁解决这个问题? (目标市场)</li>
<li>成功的机会有多大? (市场规模)</li>
<li>怎样判断产品成功与否? (度量指标)</li>
<li>有哪些同类产品? (竞品格局)</li>
<li>为什么我们最适合做这个产品? (竞争优势)</li>
<li>时机合适吗? (市场时机)</li>
<li>如何把产品推向市场? (营销组合策略)</li>
<li>成功的必要条件是什么? (解决方案要满足的条件)</li>
<li><p>根据以上问题,给出评估结论. (继续或放弃)</p>
<p>产品探索:采用流水线方式并行开发产品.也就是说,一点1.0产品进入项目执行阶段,就开始定义2.0版本的产品.</p>
</li>
</ol>
<h4 id="产品原则-确定什么最重要"><a href="#产品原则-确定什么最重要" class="headerlink" title="产品原则:确定什么最重要"></a>产品原则:确定什么最重要</h4><p>  每次加入新团队,我要做的第一件事就是制定产品原则.制定产品原则意味着决定什么重要,什么不重要,哪些原则是根本的,战略性的,哪些是临时的,战术性的.</p>
<p>  制定产品原则时容易出现两类错误.第一类是原则过于空泛,失去了指导作用.第二类是把设计原则误当成产品原则,比如,为用户提供清晰的导航路径(方便用户完成下一步操作)属于常见的设计原则,不是产品原则.</p>
<p>  在作产品决策之前,应该先确定决策要解决什么问题,让大家在一下几个要点上达成共识:</p>
<ol>
<li>究竟要解决什么问题</li>
<li>要为哪类人物角色解决这个问题</li>
<li>产品要达到什么目标</li>
<li>每项目标的优先级是什么</li>
</ol>
<h4 id="市场调研的工具和方法"><a href="#市场调研的工具和方法" class="headerlink" title="市场调研的工具和方法"></a>市场调研的工具和方法</h4><ul>
<li>用户调查</li>
<li>产品使用分析</li>
<li>数据挖掘</li>
<li>拜访用户</li>
<li>人物角色</li>
<li>可用性测试</li>
<li>同类产品分析</li>
</ul>
<p>合理的利用市场调研工具和方法可以回答一下几个关键问题:</p>
<ol>
<li>谁是目标用户?</li>
<li>用户会怎样使用产品?</li>
<li>用户能想明白怎样使用产品吗?障碍在哪里?</li>
<li>用户为什么选用你的产品?</li>
<li>用户喜欢产品的哪些特点?</li>
<li>用户希望如何改进产品,增加哪些功能?</li>
</ol>
<p>成功的产品基于以下两点认识:深入理解用户需求,以及明白什么样的解决方案在现阶段是可行的.</p>
<p>基本产品:定义最满足基本要求(价值,可用性,可行性)的产品.</p>
<p>设计产品时一定要考虑哪些功能是最重要的,争取设计出只满足基本要求的,不可删减的产品.</p>
<h4 id="改进现有产品"><a href="#改进现有产品" class="headerlink" title="改进现有产品"></a>改进现有产品</h4><p>能提高指标的功能才是你关注的重点.你应该找准方向,分析关键指标,有正对性的改进产品.</p>
<h4 id="快速响应阶段"><a href="#快速响应阶段" class="headerlink" title="快速响应阶段"></a>快速响应阶段</h4><p>关键不在于是否会出现问题,而在于能 <em>多快</em> 解决问题.</p>
<h4 id="在大公司施展拳脚"><a href="#在大公司施展拳脚" class="headerlink" title="在大公司施展拳脚"></a>在大公司施展拳脚</h4><ol>
<li>了解公司制定决策的方式</li>
<li>建立人脉网络</li>
<li>臭鼬工程</li>
<li>自己顶上</li>
<li>有选择的据理力争</li>
<li>会前沟通,形成默契</li>
<li>合理分配时间</li>
<li>分享信息</li>
<li>向上司借力</li>
<li>传播你的产品理念</li>
</ol>
<h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><h4 id="新技术层出不穷"><a href="#新技术层出不穷" class="headerlink" title="新技术层出不穷"></a>新技术层出不穷</h4><p>成功的产品往往不是新鲜事物,只是新瓶装老酒,之所以成功,是因为这个”新瓶”做的更好,更方便,更便宜,改变了消费者对”老酒”的印象.</p>
<p>现在成熟的市场上抢占一席之地,精明的公司至少要手握2两件”法宝”:</p>
<ol>
<li>对目标市场的了如指掌,对现有产品的缺陷洞若观火.</li>
<li>跟踪最新的技术趋势</li>
</ol>
<h4 id="情感接纳曲线"><a href="#情感接纳曲线" class="headerlink" title="情感接纳曲线"></a>情感接纳曲线</h4><p>根据消费者的情感特征,把他们分为技术爱好者,非理性消费者,理性消费者,超理性消费者和观望者.</p>
<p>非理性消费者最值得产品经理注意.</p>
<p>如果你带着新生的感觉去发掘每天折磨着大众的感情-孤独,恐惧,挫折,不满,你离发现新产品的日子就不远了.</p>
<h4 id="最佳实践经验"><a href="#最佳实践经验" class="headerlink" title="最佳实践经验"></a>最佳实践经验</h4><p>大大要点:</p>
<ol>
<li>产品管理的职责</li>
<li>用户体验</li>
<li>机会评估</li>
<li>特约用户</li>
<li>产品原则</li>
<li>任务角色</li>
<li>探索(定义)产品</li>
<li>使用原型</li>
<li>用户参与原型测试</li>
<li>根据数据改进产品</li>
</ol>
<h4 id="产品经理的反省清单"><a href="#产品经理的反省清单" class="headerlink" title="产品经理的反省清单"></a>产品经理的反省清单</h4><p>十大问题:</p>
<ol>
<li>产品能吸引目标消费者的关注吗?</li>
<li>产品的设计是否人性化,是否易于操作?</li>
<li>产品能在竞争中取胜吗?即使是面对未来风云变化的市场,依旧有取胜的把握吗?</li>
<li>我了解目标用户吗?产品(不是理性的产品,而是开发出来的产品)是否能得到他们的认可?</li>
<li>产品是否有别于市场上的其他产品?我能在两分钟内向公司高管清楚的阐明这些差别吗?能在一分钟内向客户解释清楚吗?能在半分钟内向经验丰富的行业分析师解释清楚吗?</li>
<li>产品能正产运行吗?</li>
<li>产品是否完整?用户对产品的印象如何?销售业绩如何?销售任务能否顺利完成?</li>
<li>产品的特设首付与目标用户的需求一致?产品特色是否鲜明?</li>
<li>产品值钱吗?值多少钱?为什么值这么多钱?用户会选择更便宜的产品吗?</li>
<li>我了解其他团队成员对产品的看法吗?他们觉得产品好在哪里?他们的看法是否与我的观点一致?</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/24/2017/读书笔记/启示录-打造用户喜爱的产品/" data-id="cizy2lg2n002mszs6rhcd1h8c" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/androidSwipeLayout源码分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/23/2017/androidSwipeLayout源码分析/" class="article-date">
  <time datetime="2017-01-23T07:19:00.000Z" itemprop="datePublished">2017-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/23/2017/androidSwipeLayout源码分析/">androidSwipeLayout源码分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="android-SwipeLayout源码分析"><a href="#android-SwipeLayout源码分析" class="headerlink" title="android SwipeLayout源码分析"></a>android SwipeLayout源码分析</h2><p>swipeLayout是代码家写的一个支持手势滑动的开源库,初看的时候感觉特别惊艳,用户体验也非常的棒,特别好奇是怎么实现的,故抽时间研究了下.<br>通过分析代码结构得出swipeLayout主要分为三大部分:</p>
<ol>
<li>内部view初始设置</li>
<li>内部ViewDragHelper的callback实现</li>
<li>冲突解决与注意事项</li>
</ol>
        
          <p class="article-more-link">
            <a href="/2017/01/23/2017/androidSwipeLayout源码分析/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/23/2017/androidSwipeLayout源码分析/" data-id="cizy2lg1b001wszs6efmhz010" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/android自定义gradle插件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/23/2017/android自定义gradle插件/" class="article-date">
  <time datetime="2017-01-23T05:31:00.000Z" itemprop="datePublished">2017-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/23/2017/android自定义gradle插件/">android自定义gradle插件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="android自定义gradle插件"><a href="#android自定义gradle插件" class="headerlink" title="android自定义gradle插件"></a>android自定义gradle插件</h2><p>  在android学习过程中,理解gradle的编译过程是非常重要的,我们可以通过自定义gradle插件来达到在编译打包的过程中人工参与其中的一部分工作,这样可以满足我们的各种需求,比如在编译之前要对所有的class做统一处理,比如打包完成之后要输出到指定的目录,这些都可以通过自定义的gradle插件来完成.</p>
<p>  下面讲解下如何在android studio中实现自定义的gradle插件</p>
<h2 id="在当前工程的gradle文件中实现插件"><a href="#在当前工程的gradle文件中实现插件" class="headerlink" title="在当前工程的gradle文件中实现插件"></a>在当前工程的gradle文件中实现插件</h2><p>  gradle插件理论上就是通过groovy语法实现的类,内部可以制定一些流程task来完成相应的工作.最简单的肯定是在当前工程的 <em>build.gradle</em> 文件中直接实现插件内容.因为实际上 <em>build.gralde</em> 就是一个groovy文件.</p>
<p>  在我们的android主工程目录中输入一下代码:</p>
  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">GreetingPlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span>&lt;<span class="title">Project</span>&gt; &#123;</span></div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="keyword">void</span> apply(Project project) &#123;</div><div class="line">       project.extensions.create(<span class="string">"greeting"</span>, GreetingPluginExtension)</div><div class="line">       project.task(<span class="string">'hello'</span>) &#123;</div><div class="line">           doLast &#123;</div><div class="line">               println <span class="string">"$&#123;project.greeting.message&#125; from $&#123;project.greeting.greeter&#125;"</span></div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingPluginExtension</span> &#123;</span></div><div class="line">   String message = <span class="string">'Hello from GreetingPlugin'</span></div><div class="line">   String greeter</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 这里首先是实现一个plugin接口,这个接口是所有的自定义插件的必须实现的.完成里面的 <em>apply</em> 方法,这里用到了一个 <em>extensions</em> 的概念,这个 <em>extensions</em> 是用来给工程project设置一些额外属性的对象.比如我们在android的 <em>build.gradle</em> 文件中经常看到的<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android&#123;</div><div class="line">  ....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 这个 <em>android{}</em> 内部就是给工程中设置的一些参数.在咱们这里的设置的是 <em>extensions</em> 叫 <em>GreetingPluginExtension</em> ,内部定义了两个参数 <em>message</em> 和 <em>greeter</em> 这里前一个参数有默认值,后一个没有,其实groovy和java的语法基本上一样的,只不过groovy是动态的java.</p>
<p>接着看plugin中的 <em>apply</em> 方法,非常的简单就是定义一个名叫 <em>hello</em> 的 <em>task</em> ,然后在里面打印一下  <em>GreetingPluginExtension</em> 中的两个参数.那在 <em>build.gradle</em> 中如何设置对应的参数呢?看下面的代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">greeting &#123;</div><div class="line">    message  &apos;Hi from gradle&apos;</div><div class="line">    greeter  &apos;Gradle&apos;</div><div class="line">&#125;</div><div class="line">```  </div><div class="line">就是这么简单直白.定义完成之后,我们直接在主目录下终端运行一下命令:</div></pre></td></tr></table></figure></p>
<p>./gradlew -q hello<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">可以看到在终端中输出:</div></pre></td></tr></table></figure></p>
<p>Hi from gradle from Gradle<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">是不是非常的简单呢.在当前工程中定义的插件只能自己用,如果要给别人用的话就需要通过一个单独的工程来生成插件了.</div><div class="line"></div><div class="line">### 在单独工程中创建自定义gradle插件</div><div class="line"></div><div class="line">首先在当前的工程中随便创建一个android module ,然后src/main目录下所有文件夹全部删除掉.然后先创建一个groovy文件夹,里面用来存放我们的插件groovy代码,一个是 *GreetingPluginExtension* ,一个是 *MyGradlePlugin* 内部代码分别对应上面的两个class.</div><div class="line"></div><div class="line">然后再创建一个 *resources* 文件夹,里面放入一个 *META-INFO* 文件夹,然后继续在 *META-INFO* 文件夹下创建 *gradle-pulgins* ,在 *gradle-pulgins* 下创建文件</div><div class="line">*com.justyan.gradle.properties* 文件,文件内容为:</div></pre></td></tr></table></figure></p>
<p>implementation-class = com.justyan.gradleplugin.MyGradlePlugin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">这里的 *com.justyan.gradle.properties* 文件的 *com.justyan.gradle* 就是你以后要给其他工程引用的的 gradle ID.比如这样:</div></pre></td></tr></table></figure></p>
<p>apply plugin: ‘com.justyan.gradle’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">这个名称你可以随便起,只要在引用的时候引用对了就ok.文件中内容的目的是指定了插件的类路径,这里就是groovy文件下的那两个groovy文件.</div><div class="line"></div><div class="line">最后的文件目录应该是这样的:</div><div class="line">![插件工程的目录结构](images/2017/01/android自定义gradle插件的目录结构.png)</div><div class="line"></div><div class="line">这里的 *META-INFO* 和 *gradle-pulgins* 是android studio给合并显示了,实际上是一个层级关系.</div><div class="line"></div><div class="line">这样插件代码就完成了,剩下的就是如果打包发布的问题了.</div><div class="line"></div><div class="line">在创建的插件的module工程中的 *build.gradle* 文件中输入一下内容:</div></pre></td></tr></table></figure></p>
<p>apply plugin: ‘groovy’<br>apply plugin: ‘maven’</p>
<p>version = ‘1.0.0’<br>group = ‘com.justyan’<br>archivesBaseName = ‘mygradleplugin’<br>repositories {<br>    mavenCentral()<br>}</p>
<p>dependencies {<br>    compile gradleApi()<br>    compile localGroovy()<br>}<br>// 一定要记得使用交叉编译选项，因为我们可能用很高的JDK版本编译，为了让安装了低版本的同学能用上我们写的插件，必须设定source和target<br>compileGroovy {<br>    sourceCompatibility = 1.7<br>    targetCompatibility = 1.7<br>    options.encoding = “UTF-8”<br>}<br>uploadArchives {<br>    repositories {<br>        mavenDeployer {<br>            repository(url: “file:////Users/justyan/Downloads/repo”)<br>        }<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">version用来表示maven生成的jar包版本号,group表示属于哪个组织, *archivesBaseName* 表示生成的java的名称.最后在 *uploadArchives* 中指定了生成的maven目录在哪里.这个目录你可以随意指定,只要后续引用的时候前后一致就可以.</div><div class="line"></div><div class="line">完成这个之后,我们调用这个工程的 *uploadArchives* task:</div></pre></td></tr></table></figure>
<p>./gradlew -q uploadArchives<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">然后就会在上面的指定目录下生成对应的maven文件了.</div><div class="line"></div><div class="line">最后,来看下如何在其他工程中引用.</div><div class="line"></div><div class="line">在要引用的工程的顶层目录的 *build.gralde* 文件中输入:</div></pre></td></tr></table></figure></p>
<p>buildscript {<br>    repositories {<br>        jcenter()<br>        maven {<br>            url uri(‘file:////Users/justyan/Downloads/repo’)<br>        }<br>    }<br>    dependencies {<br>        classpath ‘com.android.tools.build:gradle:2.2.2’<br>        classpath group: ‘com.justyan’, name: ‘mygradleplugin’,<br>                version: ‘1.0.0’<br>        // NOTE: Do not place your application dependencies here; they belong<br>        // in the individual module build.gradle files<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">首先指定maven文件目录,和上面的对应,然后在 *dependencies* 中输入组名,插件名,版本号.这样对插件的引用就完成了.最后在要使用的工程中的 *build.gralde* 文件中顶部输入:</div></pre></td></tr></table></figure>
<p>apply plugin: ‘com.justyan.gradle’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">然后用android studio同步一下gradle就可以了.这个时候在旁边的gradle project中是可以看到 *hello* 这个task的,表明插件加载成功.</div><div class="line">![task列表](images/2017/01/gradle project中的新增的task.png)</div><div class="line"></div><div class="line">最后如果我们要使用这个task和上面的方法一样,在终端中输入:</div></pre></td></tr></table></figure></p>
<p>./gradlew -q hello<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">可以看到在终端中输出:</div></pre></td></tr></table></figure></p>
<p>Hi from gradle from Gradle<br>```<br>这样自定义插件就全部搞定了,后续可以根据需求来自己实现插件中的内容了.</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://docs.gradle.org/current/userguide/custom_plugins.html" title="cutom_plugin" target="_blank" rel="external">cutom_plugin</a></p>
<p><a href="https://gold.xitu.io/entry/577bc26e165abd005530ead8" title="在 Android Studio 中自定义 Gradle 插件" target="_blank" rel="external">在 Android Studio 中自定义 Gradle 插件</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/23/2017/android自定义gradle插件/" data-id="cizy2lg16001sszs6auapuy3l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/读书笔记/富爸爸 穷爸爸读书笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/23/2017/读书笔记/富爸爸 穷爸爸读书笔记/" class="article-date">
  <time datetime="2017-01-23T00:47:00.000Z" itemprop="datePublished">2017-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/23/2017/读书笔记/富爸爸 穷爸爸读书笔记/">富爸爸 穷爸爸 读书笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="富爸爸-穷爸爸-读书笔记"><a href="#富爸爸-穷爸爸-读书笔记" class="headerlink" title="富爸爸 穷爸爸 读书笔记"></a>富爸爸 穷爸爸 读书笔记</h2><p> 我一个爸爸总是习惯对说”我可付不起”,而另一个爸爸则禁止我们说这样的话,他坚持让我们说:”我怎样才能付得起?” 这两句话,一句是陈述句,一句是疑问句.一句让你放弃,而另一句则促使你去想办法.我那个在不久之后就富起来的爸爸解释,当你下意识的说出”我付不起”的时候,你的大脑就会停止思考,而如果你自问”我怎么才能付得起”,则会让你的大脑动起来.</p>
<p> 富爸爸说:”我的大脑越用越活,大脑越活,我挣点钱就越多”.他认为,下意识的说”我可付不起”意味着精神上的懒惰.</p>
<p> 在遇到钱的问题时,一个爸爸习惯于逃避,另一个爸爸则总是想办法解决问题.长此以往,其结果就是,一个爸爸的理财能力越来越弱,而另一个爸爸的理财能力越来越强.这种结果类似于一个经常去健身房锻炼的人与一个总坐在沙发上看电视的人在体质上的不同变化.适当的体育锻炼可以增加获得健康的机会,同时,适当的脑力训练可以增加获得财富的机会.懒惰必定会让你的体质变弱,财富减少.</p>
<p> 我得说生活才是最好的老师.大多数的时候,生活不会和你说什么,只会推着你转,每一次推,它都像是在说: “喂,醒一醒,我要让你学点东西.”<br>
        
          <p class="article-more-link">
            <a href="/2017/01/23/2017/读书笔记/富爸爸 穷爸爸读书笔记/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/23/2017/读书笔记/富爸爸 穷爸爸读书笔记/" data-id="cizy2lg2o002nszs6jp140ouk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/读书笔记/&lt;搞定-无压工作的艺术&gt;" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/21/2017/读书笔记/<搞定-无压工作的艺术>/" class="article-date">
  <time datetime="2017-01-21T04:06:00.000Z" itemprop="datePublished">2017-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/21/2017/读书笔记/<搞定-无压工作的艺术>/">&lt;搞定-无压工作的艺术&gt;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="搞定-无压工作的艺术"><a href="#搞定-无压工作的艺术" class="headerlink" title="搞定-无压工作的艺术"></a>搞定-无压工作的艺术</h2><h3 id="原则-有效处理内心的承诺"><a href="#原则-有效处理内心的承诺" class="headerlink" title="原则:有效处理内心的承诺"></a>原则:有效处理内心的承诺</h3><blockquote>
<p>任何事情如果没有找到应有的位置和恰当存在方式的事物,都会pa盘踞在我们的脑海中,成为悬而未决的问题</p>
</blockquote>
<p>为了能够高效应对这一问题,首先,你必须明确并收集所有那些”进场唤醒你模糊记忆”的事情,搞定他们对你而言的真正意义,然后决定如何推动它们.</p>
<h3 id="管理承诺时的基本要求"><a href="#管理承诺时的基本要求" class="headerlink" title="管理承诺时的基本要求"></a>管理承诺时的基本要求</h3><p>如果希望出色地管理好所有的工作,那么,你需要做到以下几点:</p>
<ol>
<li>如果这件事总是占据你的大脑,你的思维就会受阻.任何一件你认为还没有完成的事情,都必须被置于一个客观,可靠地体系中,后者是我成为”文件夹”的工具之中–必须经常回访并予以清理.</li>
<li>在明白你的工作到底是什么后,你还必须做出判断:需要采取什么行动来推动工作进程</li>
<li>一旦决定了需要采取的行动方案,你必须在某一个你经常查阅的系统中保存好与这些行动相关的提示信息.</li>
</ol>
<h3 id="检验这种模式的一个重要训练"><a href="#检验这种模式的一个重要训练" class="headerlink" title="检验这种模式的一个重要训练"></a>检验这种模式的一个重要训练</h3><blockquote>
<p>像实干家一样思考,像思想家一样行动</p>
</blockquote>
<p>思考,需要构建以结果和行动为导向的思维方式.</p>
<h3 id="为什么有些事总是萦绕在我们的心头"><a href="#为什么有些事总是萦绕在我们的心头" class="headerlink" title="为什么有些事总是萦绕在我们的心头"></a>为什么有些事总是萦绕在我们的心头</h3><p>通常情况下,你对一些事情总是念念不忘,这是因为你希望他们的情况能有所改善,另外:</p>
<ul>
<li>你还没有明确的认定它们的预期结果是什么.</li>
<li>你还没有确定你下一步的具体行动是什么.</li>
<li>你还没有把关于预期结果和即将采取行动的提示信息存入你所依赖的系统中去.</li>
</ul>
<h3 id="“材料”的转化"><a href="#“材料”的转化" class="headerlink" title="“材料”的转化"></a>“材料”的转化</h3><p>“材料(stuff)”的定义:进入你的精神或现实世界中但尚未找到归属的任何事情,你尚未确定他对你的真正意义,预期结果和下一步具体行动的所有事情.</p>
<blockquote>
<p>我们需要把收集和积累的所有”材料”都转化成包含重要行动,项目和有用信息的明确清单.<br>当想法对行动具有推动作用的时候,它就是有益的;当想法成为行动的替代时,它就会成为行动的障碍.</p>
</blockquote>
<h3 id="过程-管理你的行动"><a href="#过程-管理你的行动" class="headerlink" title="过程:管理你的行动"></a>过程:管理你的行动</h3><p>你首先要养成一个习惯:清空你的大脑中的所有事物.</p>
<h3 id="管理行动的重要性"><a href="#管理行动的重要性" class="headerlink" title="管理行动的重要性"></a>管理行动的重要性</h3><p>问题的关键在于,他们无法断定到底要干些什么,下一步需要采取哪些行动.</p>
<h3 id="对行动的横向管理和纵向管理"><a href="#对行动的横向管理和纵向管理" class="headerlink" title="对行动的横向管理和纵向管理"></a>对行动的横向管理和纵向管理</h3><p>横向控制和纵向控制的目标是一致的:解除你的心理负担,并把事情做好.</p>
<h3 id="最重要的技巧-把一切事物赶出大脑"><a href="#最重要的技巧-把一切事物赶出大脑" class="headerlink" title="最重要的技巧:把一切事物赶出大脑"></a>最重要的技巧:把一切事物赶出大脑</h3><blockquote>
<p>通常,盘踞在你脑中问题的数量与解决问题的效率成反比<br>对一件事情不需要进行两次相同的思考,除非你喜欢重复思考<br>任何仅存于内心的”将会,可能或应该”性质的承诺,都会造成非理性和无法排解的全天候压力<br>思想上开小差,将是你最难战胜的敌人.</p>
</blockquote>
<h3 id="横向管理-横向管理工作流程的5个步骤"><a href="#横向管理-横向管理工作流程的5个步骤" class="headerlink" title="横向管理:横向管理工作流程的5个步骤"></a>横向管理:横向管理工作流程的5个步骤</h3><p>我们:(1)收集引起我们注意的事务和信息;(2)理清每个项目的意义和相关措施;(3)组织整理结果,提出选项;(4)进行思考回顾;(5)选择行动.这些阶段共同构成了我们生活中的横向管理系统,而且我们还可以随时向其中添加所需要考虑的新事项.</p>
<h3 id="收集阶段"><a href="#收集阶段" class="headerlink" title="收集阶段"></a>收集阶段</h3><h4 id="影响收集成功的因素"><a href="#影响收集成功的因素" class="headerlink" title="影响收集成功的因素"></a>影响收集成功的因素</h4><p>成功收集的三个必要条件:</p>
<ol>
<li>每一件悬而未决的事情都必须存储在你的收集系统中,而不是在你的大脑里</li>
<li>你应该尽可能地控制收集工具的数量,越少越好,够用即可</li>
<li>你必须定期清理这些设备</li>
</ol>
<h3 id="理清阶段"><a href="#理清阶段" class="headerlink" title="理清阶段"></a>理清阶段</h3><p>流程如下:</p>
<ol>
<li>它是什么?</li>
<li>是否需要采取行动?<ul>
<li>否<ol>
<li>无用的垃圾,根本没有必要保留</li>
<li>目前不需要,但日后可能需要处理(孵化)</li>
<li>项目具有潜在有用信息,日后可能会排上用场(参考)</li>
</ol>
</li>
<li>是<ol>
<li>你承诺完成哪些工作?达成哪些目标?(项目)</li>
<li>下一步需要采取什么行动?<ul>
<li>立即执行</li>
<li>指派他人<ol>
<li>等待别人完成</li>
</ol>
</li>
<li>延迟处理<ol>
<li>日程表(指定时间完成)</li>
<li>下一步行动(需要尽快完成的行动)<h3 id="组织整理阶段"><a href="#组织整理阶段" class="headerlink" title="组织整理阶段"></a>组织整理阶段</h3>对你那些可以付诸行动的事物,你需要:一个项目清单,一个保存项目规划和资料的存储系统,一个日程表,一个下一步行动清单,以及一个等待清单(清单中包含的内容是那些等待别人完成的任务)</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<h4 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h4><p>项目就是任何一个需要多个步骤才能完成的任务.<br>我们可以将项目视为一系列未尽之事.</p>
<h4 id="下一步行动的归类"><a href="#下一步行动的归类" class="headerlink" title="下一步行动的归类"></a>下一步行动的归类</h4><h5 id="日程表"><a href="#日程表" class="headerlink" title="日程表"></a>日程表</h5><p>你的日程表上应该标注三种情况:</p>
<ul>
<li>需要在指定时间执行的行动</li>
<li>需要在制定日期执行的行动</li>
<li>需要在指定日期获取的信息</li>
</ul>
<h3 id="回顾阶段"><a href="#回顾阶段" class="headerlink" title="回顾阶段"></a>回顾阶段</h3><p>如果你按照我所推荐的方法建立起个人的组织整理系统,那么拥有一个”项目”清单,一个日程表,”下一步行动”清单(一个或多个)和一个”等待处理”清单就是回顾的全部内容.<br>成功的关键因素:每周回顾<br>每周回顾应该完成以下任务:</p>
<ul>
<li>收集和加工处理所有的”材料”</li>
<li>回顾整个系统</li>
<li>更新各种清单</li>
<li>做到彻底,清楚,实时和完整</li>
</ul>
<h3 id="执行阶段"><a href="#执行阶段" class="headerlink" title="执行阶段"></a>执行阶段</h3><h4 id="确定某一个时刻具体行动的”四标准法”"><a href="#确定某一个时刻具体行动的”四标准法”" class="headerlink" title="确定某一个时刻具体行动的”四标准法”"></a>确定某一个时刻具体行动的”四标准法”</h4><ol>
<li>情景</li>
<li>有多少时间</li>
<li>有多少精力</li>
<li>重要性</li>
</ol>
<h3 id="确认每日工作的”三分类法”"><a href="#确认每日工作的”三分类法”" class="headerlink" title="确认每日工作的”三分类法”"></a>确认每日工作的”三分类法”</h3><ol>
<li>执行实现安排好的工作</li>
<li>处理突发事件</li>
<li>安排自己的工作</li>
</ol>
<h3 id="总体检视工作的-“六层分发”"><a href="#总体检视工作的-“六层分发”" class="headerlink" title="总体检视工作的 “六层分发”"></a>总体检视工作的 “六层分发”</h3><ul>
<li>5楼视野:目的和原则</li>
<li>4楼视野:愿景</li>
<li>3楼视野:目标</li>
<li>2楼视野:关注点及责任范围</li>
<li>1楼视野:当前项目</li>
<li>地面:当前行动</li>
</ul>
<h3 id="控制项目-纵向管理项目的5个阶段"><a href="#控制项目-纵向管理项目的5个阶段" class="headerlink" title="控制项目:纵向管理项目的5个阶段"></a>控制项目:纵向管理项目的5个阶段</h3><p>轻松自如的控制一切的关键是:(1) 明确判定工作的预期结果(目标)以及为实现目标所需要执行的下一步具体行动.(2) 把一切尚未解决的工作的提示信息安置在一个完善可靠的系统中,并定期回顾和审阅.</p>
<p>人的大脑在面对任何一项任务的时候,都要经过5个步骤:</p>
<ol>
<li>定义目标和原则</li>
<li>展望结果</li>
<li>头脑风暴/集思广益</li>
<li>组织整理</li>
<li>明确下一步的行动方案</li>
</ol>
<p>重视原则的另一个重要原因:它能为我们的行为提供清晰明确地指导</p>
<h4 id="头脑风暴的关键技巧"><a href="#头脑风暴的关键技巧" class="headerlink" title="头脑风暴的关键技巧"></a>头脑风暴的关键技巧</h4><p>这些基本的原则可以归纳为以下3点:</p>
<ul>
<li>不判断,不质疑,不评估,不批判</li>
<li>追求数量,不求质量</li>
<li>把分析组织工作置于次要的地位</li>
</ul>
<h4 id="组织整理的基本要点"><a href="#组织整理的基本要点" class="headerlink" title="组织整理的基本要点"></a>组织整理的基本要点</h4><p>组织整理的关键步骤如下:</p>
<ul>
<li>明确事件的重要组成部分</li>
<li>整理分类(按照下面一个或多个标准)<ul>
<li>构成因素</li>
<li>先后顺序</li>
<li>重要程度</li>
</ul>
</li>
<li>足够详细的描述</li>
</ul>
<p>这两个基本层面就是:我们要执行的行动和我们正在推进的项目(折现项目催动了行动).<br>这些模式有一些基本原则- 你必须收集生活中所有悬而未决的问题;然后对这些问题进行预判和处理,并确定下一步行动;接着对这些行动进行组织整理,回顾,最后付诸实施.</p>
<p>处理阶段的方法指导<br>学习的最佳途径是实践.但是,在开始之前,我还要强调几个基本原则:</p>
<ol>
<li>首先要处理工作篮中最上面的事务</li>
<li>一次一事</li>
<li>永远不要把事务再次放回工作篮</li>
</ol>
<p>下一步行动必须是可执行的具体行动</p>
<p>如果某个”下一步行动”的用时不会超过两分钟,那么不要犹豫,立刻动手完成它.</p>
<h4 id="为你创造性的想象力创建一个清单"><a href="#为你创造性的想象力创建一个清单" class="headerlink" title="为你创造性的想象力创建一个清单"></a>为你创造性的想象力创建一个清单</h4><p>典型的事情包括有:</p>
<ul>
<li>为你的家庭购买或者建造房屋</li>
<li>开始从事的业余爱好</li>
<li>想要学习的技能</li>
<li>想要表达的创意</li>
<li>需要购买的服装和饰品</li>
<li>想要得到的玩物(高科技或其他类型的玩具!)</li>
<li>计划中的旅行</li>
<li>打算参与的公益性活动</li>
<li>想了解的事情,想做的事情</li>
</ul>
<h4 id="每周回顾"><a href="#每周回顾" class="headerlink" title="每周回顾"></a>每周回顾</h4><p>如果你拥有自己独立的工作空间,你就可以让自己免于外界的干扰;如果你的工作是周一至周五的标准五天制,那么我建议你在最后工作日下午留出两个小时的时间,专门用于每周回顾.</p>
<h3 id="大局的回顾"><a href="#大局的回顾" class="headerlink" title="大局的回顾"></a>大局的回顾</h3><p>无论是在生活还是工作中,如何找出合适的范围,如果做出合适的决定,如何确定合理的时间间隔,都只有一个标准,就是让你自己感到一切清清楚楚就可以了.这是对你的终身邀约,也是你的终生义务,旨在让你实现所有未竟使命或者意向.</p>
<h3 id="检视工作"><a href="#检视工作" class="headerlink" title="检视工作"></a>检视工作</h3><p>你就有必要考虑一下,要做些什么才能让自己在这条路上走的更远,更好.因此,你应该对自己提出的问题是:</p>
<ol>
<li>我们机构的长期目标和目的是什么?为了履行我的责任,我需要完成哪些相关的项目?</li>
<li>我为自己设定的长期目标和目的是什么?为达成此目标,我改执行哪些项目?</li>
<li>还发生了哪些可能影响到我的行动的重大事情?</li>
</ol>
<h3 id="哪些项目需要你进行计划"><a href="#哪些项目需要你进行计划" class="headerlink" title="哪些项目需要你进行计划?"></a>哪些项目需要你进行计划?</h3><ol>
<li>那些你已经决定了下一步行动,却依然吸引你注意力的事务</li>
<li>那些意外冒出的新点子或临时出现新细节的项目</li>
</ol>
<h3 id="找出需要执行的”下一步行动”"><a href="#找出需要执行的”下一步行动”" class="headerlink" title="找出需要执行的”下一步行动”"></a>找出需要执行的”下一步行动”</h3><p>从最基础的层面入手,定义出行动的具体计划,并将行动提示信息有效地组织和管理起来,这是我们提高工作效率,营造轻松内循环境的关键.</p>
<h3 id="学会关注结果"><a href="#学会关注结果" class="headerlink" title="学会关注结果"></a>学会关注结果</h3><p>处理日常事务时一个重要的技巧就是:学会在脑海中对结果做出正面的预期,并以此影响实践.</p>
<h3 id="预期结果的重要性"><a href="#预期结果的重要性" class="headerlink" title="预期结果的重要性"></a>预期结果的重要性</h3><p>生活中只存在两个问题:(1) 你知道你想要达成的目标,但是不知道如何达成它; (2) 你不知道你的目标到底是上面.<br>也就存在两种解决方法:</p>
<ul>
<li>找到你的目标(结果)</li>
<li>找到具体的方法(行动)</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/21/2017/读书笔记/<搞定-无压工作的艺术>/" data-id="cizy2lg2k002lszs67vx1yldt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/java反射相关知识" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/19/2017/java反射相关知识/" class="article-date">
  <time datetime="2017-01-19T07:16:00.000Z" itemprop="datePublished">2017-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/2017/java反射相关知识/">java反射相关知识</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="java反射相关知识"><a href="#java反射相关知识" class="headerlink" title="java反射相关知识"></a>java反射相关知识</h2><h3 id="Class-getDeclaringClass-和-Class-getEnclosingClass的区别"><a href="#Class-getDeclaringClass-和-Class-getEnclosingClass的区别" class="headerlink" title="Class.getDeclaringClass 和 Class.getEnclosingClass的区别"></a>Class.getDeclaringClass 和 Class.getEnclosingClass的区别</h3><p>getDeclaringClass表示这个内的声明类是那个,常用于获取在当前中声明的内部类<br>getEnclosingClass表示获取当前类的外部调用类,也可以用于在内部类中获取外部类.<br>二者的区别在于匿名内部类,如果这个类不是在当前类中声明,那么getDeclaringClass返回null,而getEnclosingClass返回外层类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClassReflection</span></span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException </span>&#123;</div><div class="line">         <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">             <span class="meta">@Override</span></div><div class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                 Class&lt;? extends Runnable&gt; aClass = <span class="keyword">this</span>.getClass();</div><div class="line">                 Class&lt;?&gt; declaringClass2 = aClass.getDeclaringClass();</div><div class="line">                 Class&lt;?&gt; enclosingClass1 = aClass.getEnclosingClass();</div><div class="line">                 System.out.println(<span class="string">"declaringClass2 = "</span>+declaringClass2);</div><div class="line">                 System.out.println(<span class="string">"enclosingClass1 = "</span>+enclosingClass1);</div><div class="line">             &#125;</div><div class="line">         &#125;).start();</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">declaringClass2 = null</div><div class="line">enclosingClass1 = class com.justyan.reflection.TestClassReflection</div></pre></td></tr></table></figure>
<h3 id="打印出继承关系"><a href="#打印出继承关系" class="headerlink" title="打印出继承关系"></a>打印出继承关系</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printAncestor</span><span class="params">(Class aclass, ArrayList&lt;Class&gt; list)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (aclass != <span class="keyword">null</span>) &#123;</div><div class="line">           Class superclass = aclass.getSuperclass();</div><div class="line">           <span class="keyword">if</span> (superclass != <span class="keyword">null</span>) &#123;</div><div class="line">               list.add(superclass);</div><div class="line">               printAncestor(superclass, list);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>最后把所有的父类都在list中.</p>
<h3 id="Class-getGenericInterfaces方法和Class-getInterfaces方法的区别"><a href="#Class-getGenericInterfaces方法和Class-getInterfaces方法的区别" class="headerlink" title="Class.getGenericInterfaces方法和Class.getInterfaces方法的区别"></a>Class.getGenericInterfaces方法和Class.getInterfaces方法的区别</h3><p>getGenericInterfaces返回所有的实现接口,包含接口的泛型<br>getInterfaces返回所有的接口class对象,不包含泛型信息</p>
<h3 id="Class-getTypeParameters-方法"><a href="#Class-getTypeParameters-方法" class="headerlink" title="Class.getTypeParameters 方法"></a>Class.getTypeParameters 方法</h3><p>getTypeParameters返回类的泛型信息</p>
<h3 id="Class-getDeclaredMethods-和-Class-getMethods-区别"><a href="#Class-getDeclaredMethods-和-Class-getMethods-区别" class="headerlink" title="Class.getDeclaredMethods 和 Class.getMethods 区别"></a>Class.getDeclaredMethods 和 Class.getMethods 区别</h3><p>这类前面加了 <em>Declared</em> 的方法,只是获取当前类的成员,不包含父类的相关成员<br>而getMethods会获取所有的方法</p>
<h3 id="Class-getFields和Class-getDeclaredFields"><a href="#Class-getFields和Class-getDeclaredFields" class="headerlink" title="Class.getFields和Class.getDeclaredFields"></a>Class.getFields和Class.getDeclaredFields</h3><p>getFields获取当前类所有的 <em>public</em> 属性<br>getDeclaredFields返回当前类所有的属性<br>下面的话摘自官方教程</p>
<blockquote>
<p>Tip: The Class.getField() and Class.getFields() methods return the public member field(s) of the class, enum, or interface represented by &gt;the Class object. To retrieve all fields declared (but not inherited) in the Class, use the Class.getDeclaredFields() method.</p>
</blockquote>
<h3 id="反射中获取method参数的相关属性"><a href="#反射中获取method参数的相关属性" class="headerlink" title="反射中获取method参数的相关属性"></a>反射中获取method参数的相关属性</h3><p>method.getParameters用来获取该方法的所有参数.返回一个 <em>Parameter[]</em> 数组.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printParam</span><span class="params">(Method declaredMethod)</span> </span>&#123;</div><div class="line">    Parameter[] parameters = declaredMethod.getParameters();</div><div class="line">    <span class="keyword">for</span> (Parameter parameter : parameters) &#123;</div><div class="line">        System.out.println(parameter.getType());</div><div class="line">        System.out.println(parameter.getName());</div><div class="line">        System.out.println(parameter.getModifiers());</div><div class="line">        System.out.println(parameter.isImplicit());</div><div class="line">        System.out.println(parameter.isNamePresent());</div><div class="line">        System.out.println(parameter.isSynthetic());</div><div class="line">    &#125;</div><div class="line">    System.out.println(<span class="string">"-------------------------"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分别来解释下这几个方法的用法:</p>
<ol>
<li><em>getType</em> 获取参数类型,比如int,java.lang.String等</li>
<li><em>getName</em> 获取参数名称,这里有个问题要注意,默认情况下获取到的参数都是 <em>arg0</em> ,<em>arg1</em> 等这样的系统生成的参数名称,是获取不到原始的命名的,这样做的目的是为了节约class文件的空间.如果想要获取到原始参数名称,需要在编译的 <em>javac</em> 后面加上 <em>-parameters</em> 参数.</li>
<li><p><em>getModifiers</em> 是一个int值,是把下面要3种情况相加得出的.<br><img src="/images/2017/01/method的modifiers属性说明.png" alt="modifiers属性说明"></p>
</li>
<li><p><em>isImplicit</em> 和 <em>isSynthetic</em> 下面重点来讲一下</p>
</li>
<li><em>isNamePresent</em> 对应上面的 <em>getName</em> 的情况,如果是从显示的原始的class中参数命名就是true,如果是编译器生成的 <em>arg0</em> 这种方式就是 false.</li>
</ol>
<h4 id="isImplicit-和-isSynthetic"><a href="#isImplicit-和-isSynthetic" class="headerlink" title="isImplicit 和 isSynthetic"></a><em>isImplicit</em> 和 <em>isSynthetic</em></h4><p>先来看 <em>isImplicit</em> 通过字面理解就是 <em>含蓄的,隐式的</em> ,也就是说这个方法并没有在代码中直接声明,确实是存在的.对应的正常情景就是内部类对外部类的引用.我们都知道 <em>非静态</em> 内部类是对外部类有一个引用的.那么编译器在编译的时候生成的内部类的构造方法中是会有一个外部类的对象引用的.就想下面这样:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> MethodParameterExamples parent;</div><div class="line">        InnerClass(<span class="keyword">final</span> MethodParameterExamples <span class="keyword">this</span>$<span class="number">0</span>) &#123;</div><div class="line">            parent = <span class="keyword">this</span>$<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>innerClass的默认构造函数其实是对外部的MethodParameterExamples有一个引用的,那么innerClass这个默认的构造方法的 <em>isImplicit</em> 属性就是true.</p>
<p>再来看,如果一个方法既不是显式的也不是隐式的而是通过编译器生成的,那么这个 <em>isSynthetic</em> 属性就为true.经典的用在枚举类型中<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodParameterExamples</span> </span>&#123;</div><div class="line">    <span class="keyword">enum</span> Colors &#123;</div><div class="line">        RED, WHITE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果答应这里Colors类对象的话,会发现其内部是这样的:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Colors</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">Colors</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Colors RED = <span class="keyword">new</span> Colors(<span class="string">"RED"</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Colors BLUE = <span class="keyword">new</span> Colors(<span class="string">"WHITE"</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> values = <span class="keyword">new</span> Colors[]&#123; RED, BLUE &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Colors</span><span class="params">(String name, <span class="keyword">int</span> ordinal)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(name, ordinal);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Colors[] values()&#123;</div><div class="line">        <span class="keyword">return</span> values;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Colors <span class="title">valueOf</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> (Colors)java.lang.Enum.valueOf(Colors.class, name);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里面的构造函数 <em>Colors(String name , ind ordinal)</em> 是隐式声明的,其中的参数是编译器给生成的,那么参数的 <em>isSynthetic</em> 属性就是true.其中的 <em>valueOf</em> 方法中的参数是 <em>isImplicit</em> 的.<br><a href="https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html" target="_blank" rel="external">implicit and synthetic</a></p>
<h3 id="Method-isVarArgs"><a href="#Method-isVarArgs" class="headerlink" title="Method.isVarArgs()"></a>Method.isVarArgs()</h3><p> Method.isVarArgs() 表明方法的参数是不是隐式数组这种格式,比如main方法中的 <em>String… args</em></p>
<h3 id="Method的isSynthetic和isBridge"><a href="#Method的isSynthetic和isBridge" class="headerlink" title="Method的isSynthetic和isBridge"></a>Method的isSynthetic和isBridge</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMethodModifiers</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Method[] methods = Integer.class.getMethods();</div><div class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</div><div class="line">            <span class="keyword">if</span> (method.getName().equals(<span class="string">"compareTo"</span>)) &#123;</div><div class="line">                System.out.println(method.toGenericString());</div><div class="line">                System.out.println(method.isSynthetic());</div><div class="line">                System.out.println(method.isBridge());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public int java.lang.Integer.compareTo(java.lang.Integer)</div><div class="line">false</div><div class="line">false</div><div class="line">public int java.lang.Integer.compareTo(java.lang.Object)</div><div class="line">true</div><div class="line">true</div></pre></td></tr></table></figure>
<p>编译器会帮助生成一个 <em>compareTo(Object object)</em> 的中间方法,这个方法就是一个中间方法,用来解决 <em>泛型擦除?</em> 这里我也不是很明白.</p>
<h3 id="method反射调用注意事项"><a href="#method反射调用注意事项" class="headerlink" title="method反射调用注意事项"></a>method反射调用注意事项</h3><ol>
<li><p>如果要反射的方法需要传入的参数是一个数组,就像这样的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(String... arr)</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Iam test!!!!------"</span> +arr);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>如果你直接这样调用是不行的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String[] mainArgs = <span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>&#125;;</div><div class="line">method.invoke(TestMethodBean2.class.newInstance(), mainArgs);</div></pre></td></tr></table></figure>
<p>虽然你传入的确实是一个数组,但是invoke方法会认为你要调用的方法是参数个数为数组容量的方法,也就是说这里认为你想调用的是包含两个参数的test方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(String a,String b)</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Iam test!!!!------"</span> +arr);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>如果要正确调用,应该把数组对象转换为Object对象,这样就可以了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String[] mainArgs = <span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>&#125;;</div><div class="line">method.invoke(TestMethodBean2.class.newInstance(), (Object) mainArgs);</div></pre></td></tr></table></figure>
</li>
<li><p>如果要反射一个带有泛型的方法,就像这样:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMethodBean2</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(T t)</span> </span>&#123;</div><div class="line">    System.out.println(<span class="string">"it is generic"</span>);</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> TestMethodBean2&lt;Integer&gt;().getClass().getDeclaredMethod(<span class="string">"test"</span>,Integer.class);</div></pre></td></tr></table></figure>
<p>是不行的,会找不到这个方法,因为泛型在编译之后是会被擦除的,这个时候应该找的是最顶上的对象object才可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> TestMethodBean2&lt;Integer&gt;().getClass().getDeclaredMethod(<span class="string">"test"</span>,Object.class);</div></pre></td></tr></table></figure>
</li>
<li><p>对private方法的反射调用<br>要在获取到方法对象之后设置 <em>method.setAccessible(true);</em> 就可以了</p>
</li>
<li><p>如果要反射的方法没有参数,那么调用invoke方法的时候一定要注意</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">  public class MethodTrouble &#123;</div><div class="line">    public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</div><div class="line">        MethodTroubleBean bean = new MethodTroubleBean();</div><div class="line">        Method test = bean.getClass().getDeclaredMethod("test");</div><div class="line">        test.invoke(bean);  //success</div><div class="line">        test.invoke(bean, null); //success ,但是有警告</div><div class="line">        test.invoke(bean, new Object[0]); //success</div><div class="line">        Object o = new Object[0];</div><div class="line">        test.invoke(bean, o);  //wrong IllegalArgumentException</div><div class="line">        Object n = null;</div><div class="line">        test.invoke(bean, n);  //wrong IllegalArgumentException</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class MethodTroubleBean &#123;</div><div class="line">    void test() &#123;</div><div class="line">        System.out.println("test");</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">```  </div><div class="line">一定要注意对参数的传入.</div><div class="line"></div><div class="line">### Class.newInstance 和Construction.newInstance的区别</div><div class="line">Class.newInstance只能调用默认的构造函数(没有参数的那个),而且必须是可见的</div><div class="line">Construction.newInstance可以调用所有的构造函数,不管是否是可见的,也不管有多少个参数</div><div class="line">推荐使用后面这个</div><div class="line"></div><div class="line">### 反射创建数组</div><div class="line">```java</div><div class="line">Object o = Array.newInstance(int.class, 3);</div><div class="line">        Array.set(o,0,1);</div><div class="line">        Array.set(o,1,2);</div><div class="line">        Array.set(o,2,3);</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://docs.oracle.com/javase/tutorial/reflect/TOC.html" title="java reflect tutorial" target="_blank" rel="external">java reflect tutorial</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/19/2017/java反射相关知识/" data-id="cizy2lg1a001vszs64ajs3a7l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/android asyncTask源码分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/19/2017/android asyncTask源码分析/" class="article-date">
  <time datetime="2017-01-19T01:25:00.000Z" itemprop="datePublished">2017-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/2017/android asyncTask源码分析/">android asyncTask源码分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="android-AsyncTask源码分析-android7-0"><a href="#android-AsyncTask源码分析-android7-0" class="headerlink" title="android AsyncTask源码分析(android7.0)"></a>android AsyncTask源码分析(android7.0)</h2><p>  说道AsyncTask相信大家并不陌生,每当涉及到异步线程的的任务处理的时候,我们第一时间就会想到AsyncTask或者Handler.这里AsyncTask主要是android给我们封装了一层异步任务处理流程,方便使用,所以平时大家在UI中执行异步线程的时候会优先使用AsyncTask,今天就通过源码讲解一下AsyncTask的实现原理和注意事项.</p>
<h3 id="AsyncTask的用法"><a href="#AsyncTask的用法" class="headerlink" title="AsyncTask的用法"></a>AsyncTask的用法</h3><p>` <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">`	class MainAsyncTask extends AsyncTask&lt;Object,Object,Object&gt;&#123;`</div><div class="line">	 </div><div class="line">	       @Override</div><div class="line">	       protected void onPreExecute() &#123;</div><div class="line">	           super.onPreExecute();</div><div class="line">	       &#125;</div><div class="line">	 </div><div class="line">	       @Override</div><div class="line">	       protected void onPostExecute(Object o) &#123;</div><div class="line">	           super.onPostExecute(o);</div><div class="line">	       &#125;</div><div class="line">	 </div><div class="line">	       @Override</div><div class="line">	       protected Object doInBackground(Object... params) &#123;</div><div class="line">	           return null;</div><div class="line">	       &#125;</div><div class="line">	   &#125;</div><div class="line">` `</div></pre></td></tr></table></figure></p>
<p>`上面这个自定义AsyncTask就是我们平时的用法,可以看到主要用到3个方法,其中 <em>onPreExecute</em> 和 <em>onPostExecute</em> 分别表示任务开始前后的准备和收尾工作,注意这里这两个方法是在UI主线程中执行的.后面的 <em>doInBackground</em> 是任务的执行的代码,耗时的任务执行代码放在这里.注意这个方法是在异步线程中执行的.</p>
<p>当我们要使用AsyncTask的时候,通常是直接创建AsyncTask对象,然后调用execute方法,这样AsyncTask会先调用 <em>onPreExecute</em> 方法,然后开始执行 <em>doInBackground</em> 方法啊,最后任务完成之后回调 <em>onPostExecute</em> 方法.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> MainAsyncTask().execute();</div></pre></td></tr></table></figure></p>
<h3 id="AsyncTask源码"><a href="#AsyncTask源码" class="headerlink" title="AsyncTask源码"></a>AsyncTask源码</h3><p>先说结论,AsyncTask的内部实际上维护了一个线程池来调配异步任务(FutureTask)的执行,当异步任务执行完成之后就把结果交给内部的 <em>Handler</em> 来回调到UI主线程中.<br>就这么简单,我们要注意的细节有这么几点:</p>
<ol>
<li>内部线程池的结构类型</li>
<li>3个常用回调方法的调用时机</li>
<li>任务完成之后为什么不能再次调用这个AsyncTask对象重复执行.</li>
</ol>
<p>我们先从常用的 <em>execute</em> 方法入手:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MainThread</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">execute</span><span class="params">(Params... params)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> executeOnExecutor(sDefaultExecutor, params);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这里execute内部又会调用 <em>executeOnExecutor</em> 方法,这里的 <em>sDefaultExecutor</em> 后面再做解释,只要明白其就是一个线程池就可以:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MainThread</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">executeOnExecutor</span><span class="params">(Executor exec,</span></span></div><div class="line">           Params... params) &#123;</div><div class="line">       <span class="keyword">if</span> (mStatus != Status.PENDING) &#123;</div><div class="line">           <span class="keyword">switch</span> (mStatus) &#123;</div><div class="line">               <span class="keyword">case</span> RUNNING:</div><div class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></div><div class="line">                           + <span class="string">" the task is already running."</span>);</div><div class="line">               <span class="keyword">case</span> FINISHED:</div><div class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></div><div class="line">                           + <span class="string">" the task has already been executed "</span></div><div class="line">                           + <span class="string">"(a task can be executed only once)"</span>);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       mStatus = Status.RUNNING;</div><div class="line"></div><div class="line">       onPreExecute();</div><div class="line"></div><div class="line">       mWorker.mParams = params;</div><div class="line">       exec.execute(mFuture);</div><div class="line"></div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到,这个代码非常非常的简单,就是判断一下 AsyncTask 对象的状态,如果不是 <em>PENDING</em> 状态就抛出异常.如果是 <em>PENDING</em> 状态就设置为 <em>RUNNING</em> 状态,同时调用 <em>onPreExecute</em> 方法,最后交给线程池的 <em>execute</em> 方法.是不是很清晰.同时在这里发现了我们的第一个回调方法 <em>onPreExecute</em> ,注意这里通过方法上面的注解我们发现是运行在主线程中的.</p>
<p>这里传入线程池的是一个 <em>FutureTask</em> 对象 <em>mFuture</em> ,里面包含了一个 <em>mWorker</em> 对象.下面来看传给线程池的 <em>mWorker</em> 对象的实现. <em>mWorker</em> 对象是一个 <em>WorkerRunable</em> 对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerRunnable</span>&lt;<span class="title">Params</span>, <span class="title">Result</span>&gt; <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Result</span>&gt; </span>&#123;</div><div class="line">      Params[] mParams;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到 <em>WorkerRunnable</em> 对象就是一个 <em>Callable</em> 对象, <em>Callable</em> 和 <em>Runnable</em> 的区别就是有没有返回值的区别.这里AsyncTask线程池中使用的 <em>Callable</em> .<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">()</span> </span>&#123;</div><div class="line">       mWorker = <span class="keyword">new</span> WorkerRunnable&lt;Params, Result&gt;() &#123;</div><div class="line">           <span class="function"><span class="keyword">public</span> Result <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">               mTaskInvoked.set(<span class="keyword">true</span>);</div><div class="line">               Result result = <span class="keyword">null</span>;</div><div class="line">               <span class="keyword">try</span> &#123;</div><div class="line">                   Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</div><div class="line">                   <span class="comment">//noinspection unchecked</span></div><div class="line">                   result = doInBackground(mParams);</div><div class="line">                   Binder.flushPendingCommands();</div><div class="line">               &#125; <span class="keyword">catch</span> (Throwable tr) &#123;</div><div class="line">                   mCancelled.set(<span class="keyword">true</span>);</div><div class="line">                   <span class="keyword">throw</span> tr;</div><div class="line">               &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                   postResult(result);</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> result;</div><div class="line">           &#125;</div><div class="line">       &#125;;</div><div class="line"></div><div class="line">       mFuture = <span class="keyword">new</span> FutureTask&lt;Result&gt;(mWorker) &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> </span>&#123;</div><div class="line">               <span class="keyword">try</span> &#123;</div><div class="line">                   postResultIfNotInvoked(get());</div><div class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                   android.util.Log.w(LOG_TAG, e);</div><div class="line">               &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</div><div class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"An error occurred while executing doInBackground()"</span>,</div><div class="line">                           e.getCause());</div><div class="line">               &#125; <span class="keyword">catch</span> (CancellationException e) &#123;</div><div class="line">                   postResultIfNotInvoked(<span class="keyword">null</span>);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>在AsyncTask的构造函数中,完成了 <em>mWorker</em> 对象的初始化.然后把 <em>mWorker</em> 对象传给了 <em>mFuture</em> 对象. 如果对 <em>FutureTask</em> 不是很理解的同学可以去搜索一下相关的资料,非常简单. <em>FutureTask</em> 只是把要运行的对象和其返回值做了一个封装,方便线程池的回调使用.</p>
<p>在 <em>mWorker</em> 的call方法中,我们发现了第二个回调方法 <em>doInBackground</em> ,这个方法用来执行异步任务的,这里是在异步线程中执行的.<br>当任务执行完成之后,会调用 <em>postResult(result);</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Result <span class="title">postResult</span><span class="params">(Result result)</span> </span>&#123;</div><div class="line">       <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">       Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,</div><div class="line">               <span class="keyword">new</span> AsyncTaskResult&lt;Result&gt;(<span class="keyword">this</span>, result));</div><div class="line">       message.sendToTarget();</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这里可看到Handler的常规使用.来看Handler的实现:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="title">InternalHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>(Looper.getMainLooper());</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"RawUseOfParameterizedType"</span>&#125;)</div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">           AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</div><div class="line">           <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">               <span class="keyword">case</span> MESSAGE_POST_RESULT:</div><div class="line">                   <span class="comment">// There is only one result</span></div><div class="line">                   result.mTask.finish(result.mData[<span class="number">0</span>]);</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               <span class="keyword">case</span> MESSAGE_POST_PROGRESS:</div><div class="line">                   result.mTask.onProgressUpdate(result.mData);</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这里Handler里面有两个回调,先说 <em>MESSAGE_POST_RESULT</em> ,这里回到了asyncTask的 <em>finish</em> 方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(Result result)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isCancelled()) &#123;</div><div class="line">            onCancelled(result);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            onPostExecute(result);</div><div class="line">        &#125;</div><div class="line">        mStatus = Status.FINISHED;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><em>finish</em> 方法,有两个点要说明:首先你在外面调用 <em>cancel</em> 停止AsyncTask的时候,AsyncTask内部并没有停止,而是会继续执行,直到最后在finish中才做的的状态判断,只是忽略掉了返回结果而已.so,如果cancel了AsyncTask,那么是不会回调 <em>onPostExecute</em> 的,同时任务也不是立刻就停止的.如果想要任务马上停止,只能是在 <em>doInBackground</em> 方法中来对AsyncTask的状态做判断,如果状态变化了,里面return,这样可以保证任务立刻停止.<br>还有一个点要注意的是,前面有个问题:为什么AsyncTask执行完成之后不能继续调用execute方法呢.是因为在 <em>finish</em> 方法中,把这个AsyncTask对象的状态设置为 <em>FINISHED</em> ,在execute方法中第一步中就判断如果状态不是 <em>PENDING</em> 就会抛出异常.关键点在这里,所有我们如果还要二次执行任务的话,只能是重新创建一个新的AsyncTask对象了.</p>
<p>回到刚才Handler中,可以看到还有另一个异步回调情况 <em>MESSAGE_POST_PROGRESS</em> 这个是用来干什么的呢?通过字面理解我么可以发现是用来更新进度说明的.在代码中,找到了这个方法 <em>publishProgress</em> .<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * This method can be invoked from &#123;<span class="doctag">@link</span> #doInBackground&#125; to</div><div class="line">    * publish updates on the UI thread while the background computation is</div><div class="line">    * still running. Each call to this method will trigger the execution of</div><div class="line">    * &#123;<span class="doctag">@link</span> #onProgressUpdate&#125; on the UI thread.</div><div class="line">    *</div><div class="line">    * &#123;<span class="doctag">@link</span> #onProgressUpdate&#125; will not be called if the task has been</div><div class="line">    * canceled.</div><div class="line">    *</div><div class="line">    * <span class="doctag">@param</span> values The progress values to update the UI with.</div><div class="line">    *</div><div class="line">    * <span class="doctag">@see</span> #onProgressUpdate</div><div class="line">    * <span class="doctag">@see</span> #doInBackground</div><div class="line">    */</div><div class="line"><span class="meta">@WorkerThread</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">publishProgress</span><span class="params">(Progress... values)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (!isCancelled()) &#123;</div><div class="line">           getHandler().obtainMessage(MESSAGE_POST_PROGRESS,</div><div class="line">                   <span class="keyword">new</span> AsyncTaskResult&lt;Progress&gt;(<span class="keyword">this</span>, values)).sendToTarget();</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>仔细看方法上面的注释,这个方法可以在 <em>doInBackground</em> 中调用,来更新进度说明.最后这个方法会在主线程中回调 <em>onProgressUpdate</em> .<br>也就是说如果我们复写 <em>onProgressUpdate</em> 方法,我们可以在UI主线程中获取到进度更新提示.</p>
<p>上面提出的3个问题中后两个问题我们已经解释了,3个方法的回调时机非常清晰,同时AsyncTask由于最后finish状态原因是无法再次执行的.<br>最后说说AsyncTask中线程池的实现,这个点由于在不同的android版本的变化会有很多的差异,这里的源码使用是最新的7.0源码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * An &#123;<span class="doctag">@link</span> Executor&#125; that executes tasks one at a time in serial</div><div class="line">   * order.  This serialization is global to a particular process.</div><div class="line">   */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor SERIAL_EXECUTOR = <span class="keyword">new</span> SerialExecutor();</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Executor sDefaultExecutor = SERIAL_EXECUTOR;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</div><div class="line">       <span class="keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="keyword">new</span> ArrayDeque&lt;Runnable&gt;();</div><div class="line">       Runnable mActive;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">final</span> Runnable r)</span> </span>&#123;</div><div class="line">           mTasks.offer(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                   <span class="keyword">try</span> &#123;</div><div class="line">                       r.run();</div><div class="line">                   &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                       scheduleNext();</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125;);</div><div class="line">           <span class="keyword">if</span> (mActive == <span class="keyword">null</span>) &#123;</div><div class="line">               scheduleNext();</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">scheduleNext</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> ((mActive = mTasks.poll()) != <span class="keyword">null</span>) &#123;</div><div class="line">               THREAD_POOL_EXECUTOR.execute(mActive);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>这里创建了一种叫做 <em>SerialExecutor</em> 的线程池,通过字面理解可以知道是一种串行的线程池,也就是说线程是挨个来交给 <em>THREAD_POOL_EXECUTOR</em> .这里的的 <em>SerialExecutor</em> 用到了 <em>ArrayDeque</em> 这种双向队列数据结构.只允许在结尾插入,在头部取出.可以看下其中的 <em>offer</em> 和 <em>poll</em> 方法.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> offerLast(e);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> pollFirst();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>首先offer新的任务到 <em>SerialExecutor</em> 中时,判断 <em>mActive</em> 是否存在,如果不存在就去从 <em>ArrayDeque</em> 中取一个出来执行,每当其中一个任务执行完成后,最终会调用 <em>scheduleNext</em> 方法,这样就保证队列中的任务顺序执行了.</p>
<p>最后 <em>SerialExecutor</em> 是把代码交给 <em>THREAD_POOL_EXECUTOR</em> 线程池了,再来看它的实现方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CORE_POOL_SIZE = Math.max(<span class="number">2</span>, Math.min(CPU_COUNT - <span class="number">1</span>, <span class="number">4</span>));</div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_POOL_SIZE = CPU_COUNT * <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> KEEP_ALIVE_SECONDS = <span class="number">30</span>;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadFactory sThreadFactory = <span class="keyword">new</span> ThreadFactory() &#123;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger mCount = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</div><div class="line">           <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"AsyncTask #"</span> + mCount.getAndIncrement());</div><div class="line">       &#125;</div><div class="line">   &#125;;</div><div class="line"></div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =</div><div class="line">           <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">128</span>);</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line">    * An &#123;<span class="doctag">@link</span> Executor&#125; that can be used to execute tasks in parallel.</div><div class="line">    */</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor THREAD_POOL_EXECUTOR;</div><div class="line"></div><div class="line">   <span class="keyword">static</span> &#123;</div><div class="line">       ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(</div><div class="line">               CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,</div><div class="line">               sPoolWorkQueue, sThreadFactory);</div><div class="line">       threadPoolExecutor.allowCoreThreadTimeOut(<span class="keyword">true</span>);</div><div class="line">       THREAD_POOL_EXECUTOR = threadPoolExecutor;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这里的 <em>THREAD_POOL_EXECUTOR</em> 就是一个线程池的常用实现,这里就不展开了.<br>这里需要说明的是这个 <em>THREAD_POOL_EXECUTOR</em> 存在的意义,通过上面代码我们可以看到asyncTask的任务是顺序执行的,也就是说你有再多的任务也是一个一个的执行的.<br>那这样可能对需求会有影响,所以在 <em>executeOnExecutor</em> 方法中可以看到,我们是可以传入其他的线程池的,这样就可以同时执行很多任务了,而 <em>THREAD_POOL_EXECUTOR</em> 就相当于一个预置的多任务线程池,如果有这种需求,你可以直接把 <em>THREAD_POOL_EXECUTOR</em> 传给 <em>executeOnExecutor</em> 方法,这样就可以让任务同步执行了.</p>
<p>在android2.3之前,AsyncTask使用就是 <em>THREAD_POOL_EXECUTOR</em> 这种线程池模式,不过由于它最对支持128个任务容量,如果超过容量之后就会报错,同时在创建任务的过程中可能会导致ANR,所以从3.0之后就改成现在这种的串行执行的线程池方式了.这个点是要注意的.</p>
<p>如果有大量的异步任务需要执行的,不推荐使用的AsyncTask,毕竟它本身不适合重要大任务量的处理,这个时候应该自己是实现线程池来完成相关的需求.</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="http://blog.csdn.net/lmj623565791/article/details/38614699" title="Android AsyncTask 源码解析" target="_blank" rel="external"> Android AsyncTask 源码解析</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/19/2017/android asyncTask源码分析/" data-id="cizy2lg0x001mszs619io56y7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/android ButterKnife源码解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/2017/android ButterKnife源码解析/" class="article-date">
  <time datetime="2017-01-16T00:56:00.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/2017/android ButterKnife源码解析/">android ButterKnife源码解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="android-ButterKnife源码解析"><a href="#android-ButterKnife源码解析" class="headerlink" title="android ButterKnife源码解析"></a>android ButterKnife源码解析</h2><h3 id="ButterKnife基本原理"><a href="#ButterKnife基本原理" class="headerlink" title="ButterKnife基本原理"></a>ButterKnife基本原理</h3><p>通过初次查看代码结构,发现原理大致和EventBus相同,通过定义不同的注解,然后通过注解分析器来生成新的源文件代码,在里面完成view的初始化和事件绑定,最后通过 <em>ButterKnife.bind</em> 方法来反射调用生成的新的源文件的中的初始化方法,来完成view的初始化和时间绑定.</p>
<p>可以这样理解,实际上以前是把findViewById等语句放在一个方法里面了,而这个方法在onCreate里面调用.现在是onCreate里面调用了 <em>ButterKnif.bind</em> 方法,里面还是findViewById那一套,只不过是通过注解分析器提前生成了源代码,里面是findViewById那些相关的声明语句.</p>
<p>注意,通过注解预编译这种方式可以达到在编译阶段来完成view的初始化和事件绑定,相对于反射是基本上没有性能消耗,所以是值得提倡的一种的技术方式.包括之前研究的Router也是通过这种方式来达到模块之间的相互调用的功能的.</p>
<h3 id="ButterKnife源代码分析"><a href="#ButterKnife源代码分析" class="headerlink" title="ButterKnife源代码分析"></a>ButterKnife源代码分析</h3><h4 id="ButterKnife的Bind方法调用"><a href="#ButterKnife的Bind方法调用" class="headerlink" title="ButterKnife的Bind方法调用"></a>ButterKnife的Bind方法调用</h4><p>先从ButterKnife的入口来分析,比如在Activity中我们调用 <em>ButterKnife.bind(this)</em> 方法,来看其内部实现:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@NonNull</span> <span class="meta">@UiThread</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Unbinder <span class="title">bind</span><span class="params">(@NonNull Activity target)</span> </span>&#123;</div><div class="line">   View sourceView = target.getWindow().getDecorView();</div><div class="line">   <span class="keyword">return</span> createBinding(target, sourceView);</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>这里获取到的是顶层DecorView,target是activity对象本身,然后交给 <em>createBinding</em> 方法.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Unbinder <span class="title">createBinding</span><span class="params">(@NonNull Object target, @NonNull View source)</span> </span>&#123;</div><div class="line">   Class&lt;?&gt; targetClass = target.getClass();</div><div class="line">   <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">"Looking up binding for "</span> + targetClass.getName());</div><div class="line">   Constructor&lt;? extends Unbinder&gt; constructor = findBindingConstructorForClass(targetClass);</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (constructor == <span class="keyword">null</span>) &#123;</div><div class="line">     <span class="keyword">return</span> Unbinder.EMPTY;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">//noinspection TryWithIdenticalCatches Resolves to API 19+ only type.</span></div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">     <span class="keyword">return</span> constructor.newInstance(target, source);</div><div class="line">   &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Unable to invoke "</span> + constructor, e);</div><div class="line">   &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</div><div class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Unable to invoke "</span> + constructor, e);</div><div class="line">   &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">     Throwable cause = e.getCause();</div><div class="line">     <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> RuntimeException) &#123;</div><div class="line">       <span class="keyword">throw</span> (RuntimeException) cause;</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> Error) &#123;</div><div class="line">       <span class="keyword">throw</span> (Error) cause;</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Unable to create binding instance."</span>, cause);</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>这里可以看到 根据类名称来通过 <em>findBindingConstructorForClass</em> 查找该类具有两个参数的构造函数.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Nullable</span> <span class="meta">@CheckResult</span> <span class="meta">@UiThread</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Constructor&lt;? extends Unbinder&gt; findBindingConstructorForClass(Class&lt;?&gt; cls) &#123;</div><div class="line">    Constructor&lt;? extends Unbinder&gt; bindingCtor = BINDINGS.get(cls);</div><div class="line">    <span class="keyword">if</span> (bindingCtor != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">"HIT: Cached in binding map."</span>);</div><div class="line">      <span class="keyword">return</span> bindingCtor;</div><div class="line">    &#125;</div><div class="line">    String clsName = cls.getName();</div><div class="line">    <span class="keyword">if</span> (clsName.startsWith(<span class="string">"android."</span>) || clsName.startsWith(<span class="string">"java."</span>)) &#123;</div><div class="line">      <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">"MISS: Reached framework class. Abandoning search."</span>);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      Class&lt;?&gt; bindingClass = Class.forName(clsName + <span class="string">"_ViewBinding"</span>);</div><div class="line">      <span class="comment">//noinspection unchecked</span></div><div class="line">      bindingCtor = (Constructor&lt;? extends Unbinder&gt;) bindingClass.getConstructor(cls, View.class);</div><div class="line">      <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">"HIT: Loaded binding class and constructor."</span>);</div><div class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">      <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">"Not found. Trying superclass "</span> + cls.getSuperclass().getName());</div><div class="line">      bindingCtor = findBindingConstructorForClass(cls.getSuperclass());</div><div class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Unable to find binding constructor for "</span> + clsName, e);</div><div class="line">    &#125;</div><div class="line">    BINDINGS.put(cls, bindingCtor);</div><div class="line">    <span class="keyword">return</span> bindingCtor;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@VisibleForTesting</span></div><div class="line"> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, Constructor&lt;? extends Unbinder&gt;&gt; BINDINGS = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div></pre></td></tr></table></figure>
<p>这里 BINDINGS 是一个LinkedHashMap,存放的是类对象和它的构造函数对应关系.相当于一个缓存的作用,注意这里找的class对象是获取activity的类名称再加上 <em>_ViewBinding</em> 后缀.当使用ButterKnife编译完成之后,我们可以在我们工程中的build目录中找到 这些中间类.比如 你的activity名称叫做 “MainActivity”,那么生成的<br>中间类就叫做 “MainActivity_ViewBinding”.可以查看下里面的代码.就像这样:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleActivity_ViewBinding</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">SimpleActivity</span>&gt; <span class="keyword">implements</span> <span class="title">Unbinder</span> </span>&#123;</div><div class="line">  <span class="keyword">protected</span> T target;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> View view2130968578;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> View view2130968579;</div><div class="line"></div><div class="line">  <span class="meta">@UiThread</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SimpleActivity_ViewBinding</span><span class="params">(<span class="keyword">final</span> T target, View source)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.target = target;</div><div class="line"></div><div class="line">    View view;</div><div class="line">    target.title = Utils.findRequiredViewAsType(source, R.id.title, <span class="string">"field 'title'"</span>, TextView.class);</div><div class="line">    target.subtitle = Utils.findRequiredViewAsType(source, R.id.subtitle, <span class="string">"field 'subtitle'"</span>, TextView.class);</div><div class="line">    view = Utils.findRequiredView(source, R.id.hello, <span class="string">"field 'hello', method 'sayHello', and method 'sayGetOffMe'"</span>);</div><div class="line">    target.hello = Utils.castView(view, R.id.hello, <span class="string">"field 'hello'"</span>, Button.class);</div><div class="line">    view2130968578 = view;</div><div class="line">    view.setOnClickListener(<span class="keyword">new</span> DebouncingOnClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doClick</span><span class="params">(View p0)</span> </span>&#123;</div><div class="line">        target.sayHello();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    view.setOnLongClickListener(<span class="keyword">new</span> View.OnLongClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View p0)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> target.sayGetOffMe();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    view = Utils.findRequiredView(source, R.id.list_of_things, <span class="string">"field 'listOfThings' and method 'onItemClick'"</span>);</div><div class="line">    target.listOfThings = Utils.castView(view, R.id.list_of_things, <span class="string">"field 'listOfThings'"</span>, ListView.class);</div><div class="line">    view2130968579 = view;</div><div class="line">    ((AdapterView&lt;?&gt;) view).setOnItemClickListener(<span class="keyword">new</span> AdapterView.OnItemClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; p0, View p1, <span class="keyword">int</span> p2, <span class="keyword">long</span> p3)</span> </span>&#123;</div><div class="line">        target.onItemClick(p2);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    target.footer = Utils.findRequiredViewAsType(source, R.id.footer, <span class="string">"field 'footer'"</span>, TextView.class);</div><div class="line">    target.headerViews = Utils.listOf(</div><div class="line">        Utils.findRequiredView(source, R.id.title, <span class="string">"field 'headerViews'"</span>),</div><div class="line">        Utils.findRequiredView(source, R.id.subtitle, <span class="string">"field 'headerViews'"</span>),</div><div class="line">        Utils.findRequiredView(source, R.id.hello, <span class="string">"field 'headerViews'"</span>));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="meta">@CallSuper</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unbind</span><span class="params">()</span> </span>&#123;</div><div class="line">    T target = <span class="keyword">this</span>.target;</div><div class="line">    <span class="keyword">if</span> (target == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Bindings already cleared."</span>);</div><div class="line"></div><div class="line">    target.title = <span class="keyword">null</span>;</div><div class="line">    target.subtitle = <span class="keyword">null</span>;</div><div class="line">    target.hello = <span class="keyword">null</span>;</div><div class="line">    target.listOfThings = <span class="keyword">null</span>;</div><div class="line">    target.footer = <span class="keyword">null</span>;</div><div class="line">    target.headerViews = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    view2130968578.setOnClickListener(<span class="keyword">null</span>);</div><div class="line">    view2130968578.setOnLongClickListener(<span class="keyword">null</span>);</div><div class="line">    view2130968578 = <span class="keyword">null</span>;</div><div class="line">    ((AdapterView&lt;?&gt;) view2130968579).setOnItemClickListener(<span class="keyword">null</span>);</div><div class="line">    view2130968579 = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.target = <span class="keyword">null</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个java类是通过注解解析器完成通过代码来生成的.可以看到里面就是一些view的初始化和事件绑定.唯一要注意的一点是,这里的中间类都是实现了unBinder接口,实现了unBind方法,里面是对view和各种事件的回收.主要是用在 <em>fragment</em> 中的使用的,看下ButterKnife的说明会看到,在 fragment使用完成之后必须调用 <em>ViewBinder.unBinder</em> 方法来完成view的回收.<br>下面的代码来着ButterKnife的说明:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">BINDING RESET</div><div class="line"></div><div class="line">Fragments have a different view lifecycle than activities. When binding a fragment in onCreateView, set the views to <span class="keyword">null</span> in onDestroyView. Butter Knife returns an Unbinder instance when you call bind to <span class="keyword">do</span> <span class="keyword">this</span> <span class="keyword">for</span> you. Call its unbind method in the appropriate lifecycle callback.</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FancyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line">  <span class="meta">@BindView</span>(R.id.button1) Button button1;</div><div class="line">  <span class="meta">@BindView</span>(R.id.button2) Button button2;</div><div class="line">  <span class="keyword">private</span> Unbinder unbinder;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    View view = inflater.inflate(R.layout.fancy_fragment, container, <span class="keyword">false</span>);</div><div class="line">    unbinder = ButterKnife.bind(<span class="keyword">this</span>, view);</div><div class="line">    <span class="comment">// TODO Use fields...</span></div><div class="line">    <span class="keyword">return</span> view;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroyView</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDestroyView();</div><div class="line">    unbinder.unbind();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="注解分析器AnnotationProcessor的逻辑分析"><a href="#注解分析器AnnotationProcessor的逻辑分析" class="headerlink" title="注解分析器AnnotationProcessor的逻辑分析"></a>注解分析器AnnotationProcessor的逻辑分析</h4><p>核心点就在 <em>ButterKnifeProcessor</em> 里面.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123;</div><div class="line">    Set&lt;String&gt; types = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (Class&lt;? extends Annotation&gt; annotation : getSupportedAnnotations()) &#123;</div><div class="line">      types.add(annotation.getCanonicalName());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> types;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> Set&lt;Class&lt;? extends Annotation&gt;&gt; getSupportedAnnotations() &#123;</div><div class="line">    Set&lt;Class&lt;? extends Annotation&gt;&gt; annotations = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</div><div class="line"></div><div class="line">    annotations.add(BindArray.class);</div><div class="line">    annotations.add(BindBitmap.class);</div><div class="line">    annotations.add(BindBool.class);</div><div class="line">    annotations.add(BindColor.class);</div><div class="line">    annotations.add(BindDimen.class);</div><div class="line">    annotations.add(BindDrawable.class);</div><div class="line">    annotations.add(BindFloat.class);</div><div class="line">    annotations.add(BindInt.class);</div><div class="line">    annotations.add(BindString.class);</div><div class="line">    annotations.add(BindView.class);</div><div class="line">    annotations.add(BindViews.class);</div><div class="line">    annotations.addAll(LISTENERS);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> annotations;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;Class&lt;? extends Annotation&gt;&gt; LISTENERS = Arrays.asList(<span class="comment">//</span></div><div class="line">       OnCheckedChanged.class, <span class="comment">//</span></div><div class="line">       OnClick.class, <span class="comment">//</span></div><div class="line">       OnEditorAction.class, <span class="comment">//</span></div><div class="line">       OnFocusChange.class, <span class="comment">//</span></div><div class="line">       OnItemClick.class, <span class="comment">//</span></div><div class="line">       OnItemLongClick.class, <span class="comment">//</span></div><div class="line">       OnItemSelected.class, <span class="comment">//</span></div><div class="line">       OnLongClick.class, <span class="comment">//</span></div><div class="line">       OnPageChange.class, <span class="comment">//</span></div><div class="line">       OnTextChanged.class, <span class="comment">//</span></div><div class="line">       OnTouch.class <span class="comment">//</span></div><div class="line">   );</div></pre></td></tr></table></figure></p>
<p>可以通过 <em>getSupportedAnnotationTypes</em> 方法看到都支持哪些注解的处理.<br>重点的处理方法就在 <em>process</em> 方法中:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; elements, RoundEnvironment env)</span> </span>&#123;</div><div class="line">   Map&lt;TypeElement, BindingSet&gt; bindingMap = findAndParseTargets(env);</div><div class="line"></div><div class="line">   <span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingSet&gt; entry : bindingMap.entrySet()) &#123;</div><div class="line">     TypeElement typeElement = entry.getKey();</div><div class="line">     BindingSet binding = entry.getValue();</div><div class="line"></div><div class="line">     JavaFile javaFile = binding.brewJava(sdk);</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">       javaFile.writeTo(filer);</div><div class="line">     &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">       error(typeElement, <span class="string">"Unable to write binding for type %s: %s"</span>, typeElement, e.getMessage());</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到第一行就是通过遍历扫描来找到对应类的所有 <em>ButterKnife</em> 注解,然后一次性来生成每个类的新的源文件类.</p>
<p>下面来看 <em>findAndParseTargets</em> 方法.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Map&lt;TypeElement, BindingSet&gt; <span class="title">findAndParseTargets</span><span class="params">(RoundEnvironment env)</span> </span>&#123;</div><div class="line">    Map&lt;TypeElement, BindingSet.Builder&gt; builderMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line">    Set&lt;TypeElement&gt; erasedTargetNames = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</div><div class="line"></div><div class="line">    scanForRClasses(env);</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindArray element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindArray.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceArray(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindArray.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindBitmap element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindBitmap.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceBitmap(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindBitmap.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindBool element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindBool.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceBool(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindBool.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindColor element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindColor.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceColor(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindColor.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindDimen element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindDimen.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceDimen(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindDimen.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindDrawable element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindDrawable.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceDrawable(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindDrawable.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindFloat element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindFloat.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceFloat(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindFloat.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindInt element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindInt.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceInt(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindInt.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindString element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindString.class)) &#123;</div><div class="line">      <span class="keyword">if</span> (!SuperficialValidation.validateElement(element)) <span class="keyword">continue</span>;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseResourceString(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindString.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindView element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindView.class)) &#123;</div><div class="line">      <span class="comment">// we don't SuperficialValidation.validateElement(element)</span></div><div class="line">      <span class="comment">// so that an unresolved View type can be generated by later processing rounds</span></div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseBindView(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindView.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each @BindViews element.</span></div><div class="line">    <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(BindViews.class)) &#123;</div><div class="line">      <span class="comment">// we don't SuperficialValidation.validateElement(element)</span></div><div class="line">      <span class="comment">// so that an unresolved View type can be generated by later processing rounds</span></div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        parseBindViews(element, builderMap, erasedTargetNames);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logParsingError(element, BindViews.class, e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Process each annotation that corresponds to a listener.</span></div><div class="line">    <span class="keyword">for</span> (Class&lt;? extends Annotation&gt; listener : LISTENERS) &#123;</div><div class="line">      findAndParseListener(env, listener, builderMap, erasedTargetNames);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Associate superclass binders with their subclass binders. This is a queue-based tree walk</span></div><div class="line">    <span class="comment">// which starts at the roots (superclasses) and walks to the leafs (subclasses).</span></div><div class="line">    Deque&lt;Map.Entry&lt;TypeElement, BindingSet.Builder&gt;&gt; entries =</div><div class="line">        <span class="keyword">new</span> ArrayDeque&lt;&gt;(builderMap.entrySet());</div><div class="line">    Map&lt;TypeElement, BindingSet&gt; bindingMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line">    <span class="keyword">while</span> (!entries.isEmpty()) &#123;</div><div class="line">      Map.Entry&lt;TypeElement, BindingSet.Builder&gt; entry = entries.removeFirst();</div><div class="line"></div><div class="line">      TypeElement type = entry.getKey();</div><div class="line">      BindingSet.Builder builder = entry.getValue();</div><div class="line"></div><div class="line">      TypeElement parentType = findParentType(type, erasedTargetNames);</div><div class="line">      <span class="keyword">if</span> (parentType == <span class="keyword">null</span>) &#123;</div><div class="line">        bindingMap.put(type, builder.build());</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        BindingSet parentBinding = bindingMap.get(parentType);</div><div class="line">        <span class="keyword">if</span> (parentBinding != <span class="keyword">null</span>) &#123;</div><div class="line">          builder.setParent(parentBinding);</div><div class="line">          bindingMap.put(type, builder.build());</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="comment">// Has a superclass binding but we haven't built it yet. Re-enqueue for later.</span></div><div class="line">          entries.addLast(entry);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> bindingMap;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这个 <em>findAndParseTargets</em> 方法看着很长,实际上分成了3部分,顶部是用来生成id和view的对应关系,中间是各种注解的处理后放入builderMap中,第三部分是遍历builderMap来生成BindingMap的.<br>先看如何生成ID的对应关系:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scanForRClasses(env);</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scanForRClasses</span><span class="params">(RoundEnvironment env)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (trees == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">   RClassScanner scanner = <span class="keyword">new</span> RClassScanner();</div><div class="line"></div><div class="line">   <span class="keyword">for</span> (Class&lt;? extends Annotation&gt; annotation : getSupportedAnnotations()) &#123;</div><div class="line">     <span class="keyword">for</span> (Element element : env.getElementsAnnotatedWith(annotation)) &#123;</div><div class="line">       JCTree tree = (JCTree) trees.getTree(element, getMirror(element, annotation));</div><div class="line">       <span class="keyword">if</span> (tree != <span class="keyword">null</span>) &#123; <span class="comment">// tree can be null if the references are compiled types and not source</span></div><div class="line">         tree.accept(scanner);</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">for</span> (String rClass : scanner.getRClasses()) &#123;</div><div class="line">     parseRClass(rClass);</div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseRClass</span><span class="params">(String rClass)</span> </span>&#123;</div><div class="line">   Element element;</div><div class="line"></div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">     element = elementUtils.getTypeElement(rClass);</div><div class="line">   &#125; <span class="keyword">catch</span> (MirroredTypeException mte) &#123;</div><div class="line">     element = typeUtils.asElement(mte.getTypeMirror());</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   JCTree tree = (JCTree) trees.getTree(element);</div><div class="line">   <span class="keyword">if</span> (tree != <span class="keyword">null</span>) &#123; <span class="comment">// tree can be null if the references are compiled types and not source</span></div><div class="line">     IdScanner idScanner =</div><div class="line">         <span class="keyword">new</span> IdScanner(symbols, elementUtils.getPackageOf(element).getQualifiedName().toString());</div><div class="line">     tree.accept(idScanner);</div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">     parseCompiledR((TypeElement) element);</div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseCompiledR</span><span class="params">(TypeElement rClass)</span> </span>&#123;</div><div class="line">   <span class="keyword">for</span> (Element element : rClass.getEnclosedElements()) &#123;</div><div class="line">     String innerClassName = element.getSimpleName().toString();</div><div class="line">     <span class="keyword">if</span> (SUPPORTED_TYPES.contains(innerClassName)) &#123;</div><div class="line">       <span class="keyword">for</span> (Element enclosedElement : element.getEnclosedElements()) &#123;</div><div class="line">         <span class="keyword">if</span> (enclosedElement <span class="keyword">instanceof</span> VariableElement) &#123;</div><div class="line">           VariableElement variableElement = (VariableElement) enclosedElement;</div><div class="line">           Object value = variableElement.getConstantValue();</div><div class="line"></div><div class="line">           <span class="keyword">if</span> (value <span class="keyword">instanceof</span> Integer) &#123;</div><div class="line">             <span class="keyword">int</span> id = (Integer) value;</div><div class="line">             ClassName rClassName =</div><div class="line">                 ClassName.get(elementUtils.getPackageOf(variableElement).toString(), <span class="string">"R"</span>,</div><div class="line">                     innerClassName);</div><div class="line">             String resourceName = variableElement.getSimpleName().toString();</div><div class="line">             symbols.put(id, <span class="keyword">new</span> Id(id, rClassName, resourceName));</div><div class="line">           &#125;</div><div class="line">         &#125;</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RClassScanner</span> <span class="keyword">extends</span> <span class="title">TreeScanner</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; rClasses = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</div><div class="line"></div><div class="line">   <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitSelect</span><span class="params">(JCTree.JCFieldAccess jcFieldAccess)</span> </span>&#123;</div><div class="line">     Symbol symbol = jcFieldAccess.sym;</div><div class="line">     <span class="keyword">if</span> (symbol != <span class="keyword">null</span></div><div class="line">         &amp;&amp; symbol.getEnclosingElement() != <span class="keyword">null</span></div><div class="line">         &amp;&amp; symbol.getEnclosingElement().getEnclosingElement() != <span class="keyword">null</span></div><div class="line">         &amp;&amp; symbol.getEnclosingElement().getEnclosingElement().enclClass() != <span class="keyword">null</span>) &#123;</div><div class="line">       rClasses.add(symbol.getEnclosingElement().getEnclosingElement().enclClass().className());</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function">Set&lt;String&gt; <span class="title">getRClasses</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="keyword">return</span> rClasses;</div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IdScanner</span> <span class="keyword">extends</span> <span class="title">TreeScanner</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, Id&gt; ids;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String packageName;</div><div class="line"></div><div class="line">   IdScanner(Map&lt;Integer, Id&gt; ids, String packageName) &#123;</div><div class="line">     <span class="keyword">this</span>.ids = ids;</div><div class="line">     <span class="keyword">this</span>.packageName = packageName;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitClassDef</span><span class="params">(JCTree.JCClassDecl jcClassDecl)</span> </span>&#123;</div><div class="line">     <span class="keyword">for</span> (JCTree tree : jcClassDecl.defs) &#123;</div><div class="line">       <span class="keyword">if</span> (tree <span class="keyword">instanceof</span> ClassTree) &#123;</div><div class="line">         ClassTree classTree = (ClassTree) tree;</div><div class="line">         String className = classTree.getSimpleName().toString();</div><div class="line">         <span class="keyword">if</span> (SUPPORTED_TYPES.contains(className)) &#123;</div><div class="line">           ClassName rClassName = ClassName.get(packageName, <span class="string">"R"</span>, className);</div><div class="line">           VarScanner scanner = <span class="keyword">new</span> VarScanner(ids, rClassName);</div><div class="line">           ((JCTree) classTree).accept(scanner);</div><div class="line">         &#125;</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VarScanner</span> <span class="keyword">extends</span> <span class="title">TreeScanner</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, Id&gt; ids;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ClassName className;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">private</span> <span class="title">VarScanner</span><span class="params">(Map&lt;Integer, Id&gt; ids, ClassName className)</span> </span>&#123;</div><div class="line">     <span class="keyword">this</span>.ids = ids;</div><div class="line">     <span class="keyword">this</span>.className = className;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitVarDef</span><span class="params">(JCTree.JCVariableDecl jcVariableDecl)</span> </span>&#123;</div><div class="line">     <span class="keyword">if</span> (<span class="string">"int"</span>.equals(jcVariableDecl.getType().toString())) &#123;</div><div class="line">       <span class="keyword">int</span> id = Integer.valueOf(jcVariableDecl.getInitializer().toString());</div><div class="line">       String resourceName = jcVariableDecl.getName().toString();</div><div class="line">       ids.put(id, <span class="keyword">new</span> Id(id, className, resourceName));</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>这里,如何关于如何生成这个对应关系的里面用到一些api我不是很了解,网上的资料也很少,后续等到研究明白了再补充吧,只是通过字面理解应该是通过遍历java的语法分析树找到R文件中对应的filed的ID,组合成一个 <em>Id</em> .<br>中间的部分就是用来做生成builderMap的,我们挑其中的一个方法来看,大部分的方法都是类似的.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseBindView</span><span class="params">(Element element, Map&lt;TypeElement, BindingSet.Builder&gt; builderMap,</span></span></div><div class="line">                              Set&lt;TypeElement&gt; erasedTargetNames) &#123;</div><div class="line">       TypeElement enclosingElement = (TypeElement) element.getEnclosingElement();</div><div class="line"></div><div class="line">       <span class="comment">// Start by verifying common generated code restrictions.</span></div><div class="line">       <span class="keyword">boolean</span> hasError = isInaccessibleViaGeneratedCode(BindView.class, <span class="string">"fields"</span>, element)</div><div class="line">               || isBindingInWrongPackage(BindView.class, element);</div><div class="line"></div><div class="line">       <span class="comment">// Verify that the target type extends from View.</span></div><div class="line">       TypeMirror elementType = element.asType();</div><div class="line">       <span class="keyword">if</span> (elementType.getKind() == TypeKind.TYPEVAR) &#123;</div><div class="line">           TypeVariable typeVariable = (TypeVariable) elementType;</div><div class="line">           elementType = typeVariable.getUpperBound();</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (!isSubtypeOfType(elementType, VIEW_TYPE) &amp;&amp; !isInterface(elementType)) &#123;</div><div class="line">           <span class="keyword">if</span> (elementType.getKind() == TypeKind.ERROR) &#123;</div><div class="line">               note(element, <span class="string">"@%s field with unresolved type (%s) "</span></div><div class="line">                               + <span class="string">"must elsewhere be generated as a View or interface. (%s.%s)"</span>,</div><div class="line">                       BindView.class.getSimpleName(), elementType, enclosingElement.getQualifiedName(),</div><div class="line">                       element.getSimpleName());</div><div class="line">           &#125; <span class="keyword">else</span> &#123;</div><div class="line">               error(element, <span class="string">"@%s fields must extend from View or be an interface. (%s.%s)"</span>,</div><div class="line">                       BindView.class.getSimpleName(), enclosingElement.getQualifiedName(),</div><div class="line">                       element.getSimpleName());</div><div class="line">               hasError = <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (hasError) &#123;</div><div class="line">           <span class="keyword">return</span>;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="comment">// Assemble information on the field.</span></div><div class="line">       <span class="keyword">int</span> id = element.getAnnotation(BindView.class).value();</div><div class="line"></div><div class="line">       BindingSet.Builder builder = builderMap.get(enclosingElement);</div><div class="line">       <span class="keyword">if</span> (builder != <span class="keyword">null</span>) &#123;</div><div class="line">           String existingBindingName = builder.findExistingBindingName(getId(id));</div><div class="line">           <span class="keyword">if</span> (existingBindingName != <span class="keyword">null</span>) &#123;</div><div class="line">               error(element, <span class="string">"Attempt to use @%s for an already bound ID %d on '%s'. (%s.%s)"</span>,</div><div class="line">                       BindView.class.getSimpleName(), id, existingBindingName,</div><div class="line">                       enclosingElement.getQualifiedName(), element.getSimpleName());</div><div class="line">               <span class="keyword">return</span>;</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           builder = getOrCreateBindingBuilder(builderMap, enclosingElement);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       String name = element.getSimpleName().toString();</div><div class="line">       TypeName type = TypeName.get(elementType);</div><div class="line">       <span class="keyword">boolean</span> required = isFieldRequired(element);</div><div class="line"></div><div class="line">       builder.addField(getId(id), <span class="keyword">new</span> FieldViewBinding(name, type, required));</div><div class="line"></div><div class="line">       <span class="comment">// Add the type-erased version to the valid binding targets set.</span></div><div class="line">       erasedTargetNames.add(enclosingElement);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这个方法前半部分用来做ID校验,防止有重复的Id定义出现错误.<br>后半部分生成一个 <em>BindingSet.Builder</em> 对象,这个对象就是用来后续通过 <em>javapoet</em> 来生成制定的java源文件的.builderMap的key是声明注解的类,通常是我们的Activity或者viewHolder.<br>然后把 <em>FieldViewBinding</em> 放入builder中,其中 filed的key就是view本身的ID.</p>
<p><em>findAndParseTargets</em> 的最后一部分是用来生成bindingMap的,key是声明类,value是BindingSet对象.<br>通过中间生成的 <em>builderMap</em> 来完成.主要是用来子类和父类如果同时声明的时把两者合并成一个BindingSet对象.</p>
<p><em>BindingSet</em> 对象就是用来交给javaPoet来生成中间源文件的对象.</p>
<p>生成了BindingMap之后回到顶层的 <em>process</em> 方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingSet&gt; entry : bindingMap.entrySet()) &#123;</div><div class="line">            TypeElement typeElement = entry.getKey();</div><div class="line">            BindingSet binding = entry.getValue();</div><div class="line"></div><div class="line">            JavaFile javaFile = binding.brewJava(sdk);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                javaFile.writeTo(filer);</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                error(typeElement, <span class="string">"Unable to write binding for type %s: %s"</span>, typeElement, e.getMessage());</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到这里调用的是 <em>bindingSet</em> 对象的 <em>brewJava</em> 方法来完成java源文件的写入的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function">JavaFile <span class="title">brewJava</span><span class="params">(<span class="keyword">int</span> sdk)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> JavaFile.builder(bindingClassName.packageName(), createType(sdk))</div><div class="line">      .addFileComment(<span class="string">"Generated code from Butter Knife. Do not modify!"</span>)</div><div class="line">      .build();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后调用 <em>createType</em> 方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> TypeSpec <span class="title">createType</span><span class="params">(<span class="keyword">int</span> sdk)</span> </span>&#123;</div><div class="line">    TypeSpec.Builder result = TypeSpec.classBuilder(bindingClassName.simpleName())</div><div class="line">        .addModifiers(PUBLIC);</div><div class="line">    <span class="keyword">if</span> (isFinal) &#123;</div><div class="line">      result.addModifiers(FINAL);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (parentBinding != <span class="keyword">null</span>) &#123;</div><div class="line">      result.superclass(parentBinding.bindingClassName);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      result.addSuperinterface(UNBINDER);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasTargetField()) &#123;</div><div class="line">      result.addField(targetTypeName, <span class="string">"target"</span>, PRIVATE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!constructorNeedsView()) &#123;</div><div class="line">      <span class="comment">// Add a delegating constructor with a target type + view signature for reflective use.</span></div><div class="line">      result.addMethod(createBindingViewDelegateConstructor(targetTypeName));</div><div class="line">    &#125;</div><div class="line">    result.addMethod(createBindingConstructor(targetTypeName, sdk));</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasViewBindings() || parentBinding == <span class="keyword">null</span>) &#123;</div><div class="line">      result.addMethod(createBindingUnbindMethod(result, targetTypeName));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> result.build();</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p><em>createType</em> 分为三部分,一部分是createBindingViewDelegateConstructor,一部分是createBindingConstructor,还有一部分是createBindingUnbindMethod<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> MethodSpec <span class="title">createBindingViewDelegateConstructor</span><span class="params">(TypeName targetType)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> MethodSpec.constructorBuilder()</div><div class="line">      .addJavadoc(<span class="string">"@deprecated Use &#123;@link #$T($T, $T)&#125; for direct creation.\n    "</span></div><div class="line">              + <span class="string">"Only present for runtime invocation through &#123;@code ButterKnife.bind()&#125;.\n"</span>,</div><div class="line">          bindingClassName, targetType, CONTEXT)</div><div class="line">      .addAnnotation(Deprecated.class)</div><div class="line">      .addAnnotation(UI_THREAD)</div><div class="line">      .addModifiers(PUBLIC)</div><div class="line">      .addParameter(targetType, <span class="string">"target"</span>)</div><div class="line">      .addParameter(VIEW, <span class="string">"source"</span>)</div><div class="line">      .addStatement((<span class="string">"this(target, source.getContext())"</span>))</div><div class="line">      .build();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个构造函数的作用暂时没有弄明白,看说明好像是用来在运行的时候反射用的.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> MethodSpec <span class="title">createBindingConstructor</span><span class="params">(TypeName targetType, <span class="keyword">int</span> sdk)</span> </span>&#123;</div><div class="line">    MethodSpec.Builder constructor = MethodSpec.constructorBuilder()</div><div class="line">        .addAnnotation(UI_THREAD)</div><div class="line">        .addModifiers(PUBLIC);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasMethodBindings()) &#123;</div><div class="line">      constructor.addParameter(targetType, <span class="string">"target"</span>, FINAL);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      constructor.addParameter(targetType, <span class="string">"target"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (constructorNeedsView()) &#123;</div><div class="line">      constructor.addParameter(VIEW, <span class="string">"source"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      constructor.addParameter(CONTEXT, <span class="string">"context"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasUnqualifiedResourceBindings()) &#123;</div><div class="line">      <span class="comment">// Aapt can change IDs out from underneath us, just suppress since all will work at runtime.</span></div><div class="line">      constructor.addAnnotation(AnnotationSpec.builder(SuppressWarnings.class)</div><div class="line">          .addMember(<span class="string">"value"</span>, <span class="string">"$S"</span>, <span class="string">"ResourceType"</span>)</div><div class="line">          .build());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasOnTouchMethodBindings()) &#123;</div><div class="line">      constructor.addAnnotation(AnnotationSpec.builder(SUPPRESS_LINT)</div><div class="line">          .addMember(<span class="string">"value"</span>, <span class="string">"$S"</span>, <span class="string">"ClickableViewAccessibility"</span>)</div><div class="line">          .build());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (parentBinding != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (parentBinding.constructorNeedsView()) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"super(target, source)"</span>);</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (constructorNeedsView()) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"super(target, source.getContext())"</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        constructor.addStatement(<span class="string">"super(target, context)"</span>);</div><div class="line">      &#125;</div><div class="line">      constructor.addCode(<span class="string">"\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (hasTargetField()) &#123;</div><div class="line">      constructor.addStatement(<span class="string">"this.target = target"</span>);</div><div class="line">      constructor.addCode(<span class="string">"\n"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hasViewBindings()) &#123;</div><div class="line">      <span class="keyword">if</span> (hasViewLocal()) &#123;</div><div class="line">        <span class="comment">// Local variable in which all views will be temporarily stored.</span></div><div class="line">        constructor.addStatement(<span class="string">"$T view"</span>, VIEW);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">for</span> (ViewBinding binding : viewBindings) &#123;</div><div class="line">        addViewBinding(constructor, binding);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">for</span> (FieldCollectionViewBinding binding : collectionBindings) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"$L"</span>, binding.render());</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!resourceBindings.isEmpty()) &#123;</div><div class="line">        constructor.addCode(<span class="string">"\n"</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!resourceBindings.isEmpty()) &#123;</div><div class="line">      <span class="keyword">if</span> (constructorNeedsView()) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"$T context = source.getContext()"</span>, CONTEXT);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (hasResourceBindingsNeedingResource(sdk)) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"$T res = context.getResources()"</span>, RESOURCES);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">for</span> (ResourceBinding binding : resourceBindings) &#123;</div><div class="line">        constructor.addStatement(<span class="string">"$L"</span>, binding.render(sdk));</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> constructor.build();</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>这个方法来生成中间类的构造函数,里面定义了view的findViewById和绑定事件,生成的结果在前面已经列出了,就是 <em>javaPoet</em> 的API调用,非常容易理解.</p>
<p>最后是生成filed和unbind方法的 <em>createBindingUnbindMethod</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> MethodSpec <span class="title">createBindingUnbindMethod</span><span class="params">(TypeSpec.Builder bindingClass,</span></span></div><div class="line">    TypeName targetType) &#123;</div><div class="line">  MethodSpec.Builder result = MethodSpec.methodBuilder(<span class="string">"unbind"</span>)</div><div class="line">      .addAnnotation(Override.class)</div><div class="line">      .addModifiers(PUBLIC);</div><div class="line">  <span class="keyword">if</span> (!isFinal &amp;&amp; parentBinding == <span class="keyword">null</span>) &#123;</div><div class="line">    result.addAnnotation(CALL_SUPER);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (hasTargetField()) &#123;</div><div class="line">    <span class="keyword">if</span> (hasFieldBindings()) &#123;</div><div class="line">      result.addStatement(<span class="string">"$T target = this.target"</span>, targetType);</div><div class="line">    &#125;</div><div class="line">    result.addStatement(<span class="string">"if (target == null) throw new $T($S)"</span>, IllegalStateException.class,</div><div class="line">        <span class="string">"Bindings already cleared."</span>);</div><div class="line">    result.addStatement(<span class="string">"$N = null"</span>, hasFieldBindings() ? <span class="string">"this.target"</span> : <span class="string">"target"</span>);</div><div class="line">    result.addCode(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">for</span> (ViewBinding binding : viewBindings) &#123;</div><div class="line">      <span class="keyword">if</span> (binding.getFieldBinding() != <span class="keyword">null</span>) &#123;</div><div class="line">        result.addStatement(<span class="string">"target.$L = null"</span>, binding.getFieldBinding().getName());</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (FieldCollectionViewBinding binding : collectionBindings) &#123;</div><div class="line">      result.addStatement(<span class="string">"target.$L = null"</span>, binding.name);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (hasMethodBindings()) &#123;</div><div class="line">    result.addCode(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">for</span> (ViewBinding binding : viewBindings) &#123;</div><div class="line">      addFieldAndUnbindStatement(bindingClass, result, binding);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (parentBinding != <span class="keyword">null</span>) &#123;</div><div class="line">    result.addCode(<span class="string">"\n"</span>);</div><div class="line">    result.addStatement(<span class="string">"super.unbind()"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result.build();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里unBind方法不做过多的解释,主要是来看<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (ViewBinding binding : viewBindings) &#123;</div><div class="line">  addFieldAndUnbindStatement(bindingClass, result, binding);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addFieldAndUnbindStatement</span><span class="params">(TypeSpec.Builder result, MethodSpec.Builder unbindMethod,</span></span></div><div class="line">    ViewBinding bindings) &#123;</div><div class="line">  <span class="comment">// Only add fields to the binding if there are method bindings.</span></div><div class="line">  Map&lt;ListenerClass, Map&lt;ListenerMethod, Set&lt;MethodViewBinding&gt;&gt;&gt; classMethodBindings =</div><div class="line">      bindings.getMethodBindings();</div><div class="line">  <span class="keyword">if</span> (classMethodBindings.isEmpty()) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  String fieldName = bindings.isBoundToRoot() ? <span class="string">"viewSource"</span> : <span class="string">"view"</span> + bindings.getId().value;</div><div class="line">  result.addField(VIEW, fieldName, PRIVATE);</div><div class="line"></div><div class="line">  <span class="comment">// We only need to emit the null check if there are zero required bindings.</span></div><div class="line">  <span class="keyword">boolean</span> needsNullChecked = bindings.getRequiredBindings().isEmpty();</div><div class="line">  <span class="keyword">if</span> (needsNullChecked) &#123;</div><div class="line">    unbindMethod.beginControlFlow(<span class="string">"if ($N != null)"</span>, fieldName);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (ListenerClass listenerClass : classMethodBindings.keySet()) &#123;</div><div class="line">    <span class="comment">// We need to keep a reference to the listener</span></div><div class="line">    <span class="comment">// in case we need to unbind it via a remove method.</span></div><div class="line">    <span class="keyword">boolean</span> requiresRemoval = !<span class="string">""</span>.equals(listenerClass.remover());</div><div class="line">    String listenerField = <span class="string">"null"</span>;</div><div class="line">    <span class="keyword">if</span> (requiresRemoval) &#123;</div><div class="line">      TypeName listenerClassName = bestGuess(listenerClass.type());</div><div class="line">      listenerField = fieldName + ((ClassName) listenerClassName).simpleName();</div><div class="line">      result.addField(listenerClassName, listenerField, PRIVATE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!VIEW_TYPE.equals(listenerClass.targetType())) &#123;</div><div class="line">      unbindMethod.addStatement(<span class="string">"(($T) $N).$N($N)"</span>, bestGuess(listenerClass.targetType()),</div><div class="line">          fieldName, removerOrSetter(listenerClass, requiresRemoval), listenerField);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      unbindMethod.addStatement(<span class="string">"$N.$N($N)"</span>, fieldName,</div><div class="line">          removerOrSetter(listenerClass, requiresRemoval), listenerField);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (requiresRemoval) &#123;</div><div class="line">      unbindMethod.addStatement(<span class="string">"$N = null"</span>, listenerField);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  unbindMethod.addStatement(<span class="string">"$N = null"</span>, fieldName);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (needsNullChecked) &#123;</div><div class="line">    unbindMethod.endControlFlow();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法用来生成中间类的filed,也就是view和事件的声明.之前在前面找了半天如何生成filed的方法一直没有找到,后来这这里才发现的.<br>声明的view名称是View+ID这种格式.</p>
<p>到这里大概的流程就讲完了,可能还是有些细节没有讲到,不过没有关系,只要明白了大概的运行方式就可以了.可以看到作者的思路非常的新颖就是通过中间类来完成一些初始化工作,这个给我们后续的android的编程中提供了一套可借鉴的思路.</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="http://jakewharton.github.io/butterknife/" title="butterKnife document" target="_blank" rel="external">butterKnife document</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/16/2017/android ButterKnife源码解析/" data-id="cizy2lg0s001iszs6uqddng2z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017/读书笔记/2017-01-15-出奇制胜-在快速变化的世界如何加速成功" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/15/2017/读书笔记/2017-01-15-出奇制胜-在快速变化的世界如何加速成功/" class="article-date">
  <time datetime="2017-01-15T02:47:00.000Z" itemprop="datePublished">2017-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/15/2017/读书笔记/2017-01-15-出奇制胜-在快速变化的世界如何加速成功/">出奇制胜-在快速变化的世界如何加速成功</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="出奇制胜-在快速变化的世界如何加速成功"><a href="#出奇制胜-在快速变化的世界如何加速成功" class="headerlink" title="出奇制胜-在快速变化的世界如何加速成功"></a>出奇制胜-在快速变化的世界如何加速成功</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>缩短行程，善于借力，一飞冲天</p>
<p>借力是超级成功人士运用自己的已知资源获得最大回报的秘诀所在。</p>
<p>好运和才华是成功的两大要素，但像任何配方一样，他们都可以通过精心的设计为其他因素所代替。然而我发现，一个不可替代的要素就是“肯干”。</p>
<p>最佳的成功之路-无论你如何定义它-一定每天都在变化。</p>
<h3 id="换梯术"><a href="#换梯术" class="headerlink" title="换梯术"></a>换梯术</h3><p>串注：累加性质的系列投注，每次赌博获胜的奖金都作为下一次赌注的投注额。</p>
<p>越快越好，积小胜为大胜</p>
<p>横向交易：更大或更好</p>
<h3 id="师傅领进门"><a href="#师傅领进门" class="headerlink" title="师傅领进门"></a>师傅领进门</h3><p>与师傅或者导师培养出良好的人际关系，成为毕生的挚友</p>
<h3 id="快速反馈"><a href="#快速反馈" class="headerlink" title="快速反馈"></a>快速反馈</h3><p>奥斯卡.王尔德说过：“经验是每个人给自己的错误起的名字”。</p>
<p>“分析自己的败因时，个人往往从外界找理由，单挑那些他们直接控制不了的因素说事儿，比如运气，其结果是，他们以后在同一任务上继续努力的动力收到了削弱。”</p>
<p>“即使一个人失败的经验可能包含有价值的只是，但如果以后不对这一经验进行反思，学习的潜力仍将无从发挥。”</p>
<p>专家，反而普通推崇消极反馈而不是积极反馈。消极反馈能够刺激人们进行最大限度的改进，这是因为批评通常比赞美更具有可操作性。</p>
<p>关于消极反馈比较难办的部分是如何保护自己不受预知失败的打击，把我们的经验转化为客观的实验。而当我们这样做时，反馈的作用就会变得更加强大。</p>
<p>第二城市设法做到三件事，以加快其演员的成长：</p>
<ol>
<li>提供快速反馈</li>
<li>使反馈对事不对人</li>
<li>降低代价和压力</li>
</ol>
<h3 id="利用平台"><a href="#利用平台" class="headerlink" title="利用平台"></a>利用平台</h3><p>DHH的“选择性偷懒”：“我的计划是，假设别人得A花的时间为100%，如果我用5%的时间就能得C-，那就很牛了。这样当然够及格了，对吧,然后我就把剩下的95%的时间用来去做我一些真正愿意干的事”</p>
<p>平台的形式可以是工具，也可以是技术，可以使游戏，轮胎，计算器，更可以是职业赛车联盟或高标准学校提供的环境。无论是哪种形式，平台都发挥了功效增倍的作用，而且能够在人们使用平台的过程中传授给他只是。</p>
<h3 id="抓住浪潮"><a href="#抓住浪潮" class="headerlink" title="抓住浪潮"></a>抓住浪潮</h3><p>所谓运气，就是“在正确的时间出现在正确的地方”。但是，有些人-以及公司-却像冲浪运动员一样，善于让自己在正确的时间出现在正确的地方。他们寻找机会，而不是等待机会。</p>
<p>无论是哪个行业，情况都是一样的。行业先驱者沉浸在早期的技术和实践中不能自拔，最后被尾随而来的企业后发制人，完成超越。上船容易下船难，一旦成为第一波的弄潮儿，再想全身而退，代价就太大了。</p>
<p>去海边观察，然后下水体验。</p>
<h3 id="超级联系人"><a href="#超级联系人" class="headerlink" title="超级联系人"></a>超级联系人</h3><p>“超连（superconnecting)”的思路，即直接切入具有广泛传播能力的中枢，然后通过它事先大规模的联系。</p>
<h3 id="创造动能"><a href="#创造动能" class="headerlink" title="创造动能"></a>创造动能</h3><p>要想成功驭势而行，就要善于积累潜在的能量，只有这样，才能让不期而遇的机遇功效成倍放大。</p>
<p>成功会在你最意想不到的时候降临到你身上，而你要做的就是让这股势头一直保持下去。</p>
<h3 id="大道至简"><a href="#大道至简" class="headerlink" title="大道至简"></a>大道至简</h3><p>大道至简往往成为从优秀走向卓越的关键。</p>
<p>颠覆性创新产品的主要特点是节约成本（时间或金钱)。但每一种颠覆性产品成功背后的关键因素这是简化。</p>
<p>进行大量微不足道的选择，会让一个人的自我控制能力消耗殆尽。</p>
<h3 id="10被思维"><a href="#10被思维" class="headerlink" title="10被思维"></a>10被思维</h3><p>“尝试做一样新东西或者是更好的东西，做法最终不外乎那么两种情况。一种是小幅变动，不会吓人一跳的版本改进。改变生产模式，如果你愿意的话。从程度上来说，你往往得到的就是10%的改进。但如果想要获得真正的巨大革新，一般来说<br>你就得重新开始，尝试另一种方式或很多种方式。你必须打破一些基本的假设，当然，你不可能未卜先知，只能去摸索，去试。显然，这个时候就得打破常规，违背常理。<br>”</p>
<p>当我们去争取挂在低枝上的果实时，实际上是不太可能把潜力发挥到极致的。部分原因是，在树的底部，竞争比树的顶部更激烈。而大量的竞争不只会降低获胜的概率，而且还会导致表现欠佳。</p>
<p>N效应：在竞争中，仅仅知道会有更多的竞争对说参加，就会降低我们的表现。</p>
<p>人性的本质使我们出乎意料的愿意支持伟大的理想，巨大的改变。这意味着梦想家会赢得更多的客户，更多的投资，以及更多的口碑。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/01/15/2017/读书笔记/2017-01-15-出奇制胜-在快速变化的世界如何加速成功/" data-id="cizy2lg2f002gszs68y603ggn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-blog-github/">java blog github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-blog-github/">java, blog, github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/blog/" style="font-size: 20px;">blog</a> <a href="/tags/github/" style="font-size: 20px;">github</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/java-blog-github/" style="font-size: 10px;">java blog github</a> <a href="/tags/java-blog-github/" style="font-size: 10px;">java, blog, github</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/25/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/02/21/2017/android binder与aidl/">android binder与AIDL</a>
          </li>
        
          <li>
            <a href="/2017/02/17/2017/Android LruMemoryCache源码分析/">Android LruMemoryCache源码分析</a>
          </li>
        
          <li>
            <a href="/2017/02/17/2017/android DiskLruCache源码分析/">android DiskLruCache源码分析</a>
          </li>
        
          <li>
            <a href="/2017/02/15/2017/读书笔记/读书笔记书写技巧/">读书笔记书写技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>