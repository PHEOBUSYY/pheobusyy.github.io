<!DOCTYPE html><html class="has-navbar-fixed-top" lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title></title><script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" type="text/css" href="/css/bulma.css"><link rel="stylesheet" type="text/css" href="/css/justyan.css"><link rel="stylesheet" type="text/css" href="/highlight/styles/dracula.css"><link rel="icon" href="/img/favicon.png"></head><body><section class="hero is-info is-medium"><div class="hero-head"><nav class="navbar is-fixed-top is-info"><div class="container"><div class="navbar-brand"><a class="navbar-item"><img class="navbar-circle" src="https://avatars2.githubusercontent.com/u/9360264?s=50&amp;u=5e88482f7319a8ce65ed618bcede72ea97a7f5aa&amp;v=4"></a><span class="navbar-burger burger" data-target="navbarMenuHeroA"><span></span><span></span><span></span></span></div><div class="navbar-menu" id="navbarMenuHeroA"><div class="navbar-end"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/category">Categories</a><a class="navbar-item" href="/contact">Contact</a><span class="navbar-item"><a class="button is-info is-inverted" href="https://github.com/PHEOBUSYY"><span class="icon"><i class="fab fa-github"></i></span><span>Github</span></a></span></div></div></div></nav></div><div class="hero-body"><div class="has-text-centered"><h1 class="title">java design pattern - interpreter pattern</h1><h2 class="subtitle">2016-06-14</h2></div></div><div class="hero-foot"></div></section><div id="content-outer"><div id="content-inner"><article id="post"><div id="toc"><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#场景"><span class="toc-number">1.</span> <span class="toc-text">场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解释器模式"><span class="toc-number">2.</span> <span class="toc-text">解释器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">3.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="post-text"><!-- TOC depthFrom:2 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->
<ul>
<li><a href="#场景">场景</a></li>
<li><a href="#解释器模式">解释器模式</a></li>
<li><a href="#参考资料">参考资料</a></li>
</ul>
<!-- /TOC -->
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>  解释器模式在编程中很少用到，一般是用来自己定义一套简单的语法语句通过解释器解释执行，在这里简单的实现一下完事。</p>
<h2 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h2><p>  解释器模式是一种行为模式，用来通过解释器来解析简单语句并执行。<br>  比如可以通过解释器来模拟一个简单的四则运算。<br>  解释器模式主要由4个角色组成：</p>
<ul>
<li>abstractExpression 定义了通用的解释行为方法 inerpreter(context)</li>
<li>TerminalExpression 具体值参数，在四则运算中就是数字</li>
<li>NonTerminalExpression 操作符 ，对应四则运算的加减乘除</li>
<li>context 上下文对象，用来保存一些常用的值等中间信息</li>
</ul>
<p><img src="/images/2016/06/interpreter_pattern_uml.jpg" alt="interpreter pattern"></p>
<a id="more"></a>
<p>下面是一个四则运算的demo：</p>
<pre><code class="java">public interface Expression {
    int interpreter(Context context);
}
</code></pre>
<pre><code class="java">public class IntValue implements Expression {
    private int value ;

    public IntValue(int value) {
        this.value = value;
    }

    @Override
    public int interpreter(Context context) {
        return value;
    }
}
</code></pre>
<pre><code class="java">public abstract class Symbol implements Expression {
    protected Expression intValue1,intValue2;

    public Symbol(Expression intValue1, Expression intValue2) {
        this.intValue1 = intValue1;
        this.intValue2 = intValue2;
    }
}
</code></pre>
<pre><code class="java">public class AddOperation extends Symbol{
    public AddOperation(Expression intValue1, Expression intValue2) {
        super(intValue1, intValue2);
    }

    @Override
    public int interpreter(Context context) {
        return intValue1.interpreter(context) + intValue2.interpreter(context);
    }
}
</code></pre>
<pre><code class="java">public class MultiOperation extends Symbol {

    public MultiOperation(Expression intValue1, Expression intValue2) {
        super(intValue1, intValue2);
    }

    @Override
    public int interpreter(Context context) {
        return intValue1.interpreter(context) * intValue2.interpreter(context);
    }
}
</code></pre>
<pre><code class="java">public class DivOperation extends Symbol {

    public DivOperation(Expression intValue1, Expression intValue2) {
        super(intValue1, intValue2);
    }

    @Override
    public int interpreter(Context context) {
        return intValue1.interpreter(context) / intValue2.interpreter(context);
    }
}
</code></pre>
<pre><code class="java">public class RemoveOperation extends Symbol {
    public RemoveOperation(Expression intValue1, Expression intValue2) {
        super(intValue1, intValue2);
    }

    @Override
    public int interpreter(Context context) {
        return intValue1.interpreter(context) - intValue2.interpreter(context);
    }
}
</code></pre>
<pre><code class="java">public class Processor {
    public static int process(String expression,Context context){
        Stack&lt;Expression&gt; stack = new Stack&lt;&gt;();
        for (int i = 0; i &lt; expression.split(&quot; &quot;).length; i++) {
            String ex = expression.split(&quot; &quot;)[i];
            if (ex.equals(&quot;*&quot;)) {
                String next = expression.split(&quot; &quot;)[++i];
                Expression pop = stack.pop();
                IntValue intValue2 = new IntValue(Integer.parseInt(next));
                stack.push(new MultiOperation(pop, intValue2));
            } else if (ex.equals(&quot;/&quot;)) {
                String next = expression.split(&quot; &quot;)[++i];
                Expression pop = stack.pop();
                IntValue intValue2 = new IntValue(Integer.parseInt(next));
                stack.push(new DivOperation(pop, intValue2));
            } else if (ex.equals(&quot;+&quot;)) {
                String next = expression.split(&quot; &quot;)[++i];
                Expression pop = stack.pop();
                IntValue intValue2 = new IntValue(Integer.parseInt(next));
                stack.push(new AddOperation(pop, intValue2));
            } else if (ex.equals(&quot;-&quot;)) {
                String next = expression.split(&quot; &quot;)[++i];
                Expression pop = stack.pop();
                IntValue intValue2 = new IntValue(Integer.parseInt(next));
                stack.push(new RemoveOperation(pop, intValue2));
            } else {
                stack.push(new IntValue(Integer.parseInt(ex)));
            }
        }
        return stack.pop().interpreter(context);
    }
}
</code></pre>
<pre><code class="java">public class Test {
    public static void main(String[] args) {
        Context context = new Context();
        String string = &quot;1 + 1 * 2&quot;;
        System.out.println(&quot;Process=&quot;+Processor.process(string,context));
    }
}
</code></pre>
<pre><code class="java">Process=4
</code></pre>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://en.wikipedia.org/wiki/Interpreter_pattern" title="Interpreter pattern" target="_blank" rel="external">Interpreter pattern</a></p>
<p><a href="http://www.tutorialspoint.com/design_pattern/interpreter_pattern.htm" title="Design Patterns - Interpreter Pattern" target="_blank" rel="external">Design Patterns - Interpreter Pattern</a></p>
</div></article><div></div></div></div><div id="bottom-outer"><div id="bottom-inner"><span>Site construction by</span><span> JustYan </span><span>using</span><a href="http://hexo.io"><span>hexo blog framework</span></a><span>.</span><br><a href="/">Home</a></div></div><script src="/js/justyan.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>